<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 9: RSI ä¸è¶…ä¹°è¶…å– â€” æ„å»º Mean Reversion ä¿¡å· | é‡åŒ–æ—¥æ¨</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #21262d;
      --border: #30363d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #58a6ff;
      --accent2: #f78166;
      --green: #3fb950;
      --red: #f85149;
      --yellow: #d29922;
      --purple: #bc8cff;
      --orange: #ffa657;
      --teal: #39d353;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;
      line-height: 1.7;
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }
    /* Header */
    .header {
      border-bottom: 1px solid var(--border);
      padding-bottom: 2rem;
      margin-bottom: 2.5rem;
    }
    .day-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #1f4068, #1b262c);
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 0.3rem 0.9rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }
    .phase-tag {
      display: inline-block;
      background: var(--purple);
      color: #0d1117;
      font-size: 0.7rem;
      font-weight: 700;
      padding: 0.15rem 0.6rem;
      border-radius: 12px;
      margin-left: 0.5rem;
    }
    h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text) 40%, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.25;
      margin-bottom: 0.8rem;
    }
    .subtitle {
      color: var(--muted);
      font-size: 1.05rem;
    }
    .meta {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--muted);
    }
    /* TOC */
    .toc {
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent);
      border-radius: 8px;
      padding: 1.2rem 1.5rem;
      margin-bottom: 2.5rem;
    }
    .toc h3 { font-size: 0.85rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.8rem; }
    .toc ol { padding-left: 1.2rem; }
    .toc li { margin: 0.3rem 0; }
    .toc a { color: var(--accent); text-decoration: none; font-size: 0.9rem; }
    .toc a:hover { text-decoration: underline; }
    /* Sections */
    section { margin-bottom: 3rem; }
    h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 1.2rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    h2 .icon { font-size: 1.3rem; }
    h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent);
      margin: 1.5rem 0 0.7rem;
    }
    p { margin-bottom: 1rem; color: var(--text); }
    /* Formula boxes */
    .formula-box {
      background: linear-gradient(135deg, #0d2137, #1a1f2e);
      border: 1px solid var(--accent);
      border-radius: 10px;
      padding: 1.5rem 2rem;
      margin: 1.5rem 0;
      text-align: center;
    }
    .formula-box .formula {
      font-family: 'Courier New', monospace;
      font-size: 1.3rem;
      color: var(--accent);
      font-weight: 700;
      letter-spacing: 0.05em;
    }
    .formula-box .formula-sub {
      font-family: 'Courier New', monospace;
      font-size: 1rem;
      color: var(--purple);
      margin-top: 0.6rem;
    }
    .formula-box .formula-note {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 0.8rem;
      font-style: italic;
    }
    /* Code blocks */
    pre {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.3rem 1.5rem;
      overflow-x: auto;
      margin: 1.2rem 0;
      font-size: 0.875rem;
      line-height: 1.6;
    }
    code {
      font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
    }
    pre code { color: var(--text); }
    .kw { color: #ff7b72; }    /* keyword */
    .fn { color: #d2a8ff; }    /* function */
    .st { color: #a5d6ff; }    /* string */
    .cm { color: #8b949e; font-style: italic; } /* comment */
    .nm { color: #79c0ff; }    /* number */
    .op { color: #ff7b72; }    /* operator */
    .cl { color: #ffa657; }    /* class */
    inline-code, .ic {
      font-family: monospace;
      background: var(--surface2);
      padding: 0.15em 0.4em;
      border-radius: 4px;
      font-size: 0.9em;
      color: var(--orange);
    }
    /* Cards */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.2rem;
    }
    .card.green { border-top: 3px solid var(--green); }
    .card.red { border-top: 3px solid var(--red); }
    .card.blue { border-top: 3px solid var(--accent); }
    .card.purple { border-top: 3px solid var(--purple); }
    .card.yellow { border-top: 3px solid var(--yellow); }
    .card h4 { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; }
    .card.green h4 { color: var(--green); }
    .card.red h4 { color: var(--red); }
    .card.blue h4 { color: var(--accent); }
    .card.purple h4 { color: var(--purple); }
    .card.yellow h4 { color: var(--yellow); }
    .card p { font-size: 0.88rem; color: var(--muted); margin: 0; }
    /* Alerts */
    .alert {
      border-radius: 8px;
      padding: 1rem 1.2rem;
      margin: 1.2rem 0;
      font-size: 0.9rem;
      border-left: 4px solid;
    }
    .alert.warning { background: rgba(210, 153, 34, 0.1); border-color: var(--yellow); color: #f0c060; }
    .alert.danger  { background: rgba(248, 81, 73, 0.1);  border-color: var(--red);    color: #ff9090; }
    .alert.info    { background: rgba(88, 166, 255, 0.1); border-color: var(--accent); color: #9ecfff; }
    .alert.success { background: rgba(63, 185, 80, 0.1);  border-color: var(--green);  color: #7fdc96; }
    .alert strong { display: block; margin-bottom: 0.3rem; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.06em; }
    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.2rem 0;
      font-size: 0.88rem;
    }
    th {
      background: var(--surface2);
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.78rem;
      padding: 0.7rem 1rem;
      text-align: left;
      border-bottom: 2px solid var(--border);
    }
    td {
      padding: 0.65rem 1rem;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }
    tr:hover td { background: var(--surface); }
    /* RSI Gauge */
    .rsi-gauge {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .rsi-bar {
      position: relative;
      height: 40px;
      border-radius: 6px;
      background: linear-gradient(to right,
        #1a3a4a 0%,       /* 0 */
        #1d4a1d 15%,      /* oversold zone 0-30 */
        #2a2a1a 30%,      /* neutral start */
        #2a2a1a 70%,      /* neutral end */
        #4a1d1d 85%,      /* overbought zone 70-100 */
        #4a1d1d 100%      /* 100 */
      );
      margin: 1rem 0;
      overflow: hidden;
    }
    .rsi-zones {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--muted);
      padding: 0 0.2rem;
    }
    .rsi-zone-label {
      text-align: center;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    .rsi-zone-label.oversold { color: var(--green); }
    .rsi-zone-label.neutral { color: var(--yellow); }
    .rsi-zone-label.overbought { color: var(--red); }
    /* Step list */
    .steps { margin: 1rem 0; }
    .step {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      align-items: flex-start;
    }
    .step-num {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      color: #0d1117;
      font-weight: 700;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .step-content { flex: 1; }
    .step-content strong { color: var(--text); }
    .step-content p { font-size: 0.9rem; color: var(--muted); margin: 0.2rem 0 0; }
    /* Divergence visual */
    .divergence-box {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .div-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.2rem;
    }
    .div-card.bullish { border-top: 3px solid var(--green); }
    .div-card.bearish { border-top: 3px solid var(--red); }
    .div-card h4 { margin-bottom: 0.8rem; font-size: 0.95rem; }
    .div-card.bullish h4 { color: var(--green); }
    .div-card.bearish h4 { color: var(--red); }
    .signal-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      padding: 0.3rem 0;
      border-bottom: 1px solid var(--border);
    }
    .signal-row:last-child { border-bottom: none; }
    .signal-row .label { color: var(--muted); }
    .signal-row .val { font-weight: 600; }
    .signal-row .val.up { color: var(--green); }
    .signal-row .val.down { color: var(--red); }
    /* Market section */
    .market-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.3rem;
      margin: 1rem 0;
    }
    .market-card .ticker {
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }
    .market-card .ticker .symbol { color: var(--accent); }
    .market-card .ticker .name { color: var(--muted); font-size: 0.85rem; font-weight: 400; }
    .metric-row {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .metric {
      display: flex;
      flex-direction: column;
    }
    .metric .key { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .metric .val { font-size: 1.2rem; font-weight: 700; }
    .metric .val.overbought { color: var(--red); }
    .metric .val.oversold { color: var(--green); }
    .metric .val.neutral { color: var(--yellow); }
    /* Trap section */
    .trap-list { list-style: none; padding: 0; }
    .trap-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: 4px solid var(--red);
      border-radius: 0 8px 8px 0;
      padding: 1rem 1.2rem;
      margin-bottom: 0.8rem;
    }
    .trap-item .trap-title { font-weight: 700; color: var(--red); margin-bottom: 0.3rem; font-size: 0.95rem; }
    .trap-item p { font-size: 0.88rem; color: var(--muted); margin: 0; }
    /* Connection */
    .connection-box {
      background: linear-gradient(135deg, var(--surface), #1a1f2e);
      border: 1px solid var(--purple);
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .connection-box h4 { color: var(--purple); margin-bottom: 0.8rem; }
    .connection-box p { font-size: 0.9rem; color: var(--muted); }
    /* Thought question */
    .thought-q {
      background: linear-gradient(135deg, #1a1f2e, #0d2137);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 2rem;
      margin-top: 3rem;
      text-align: center;
    }
    .thought-q .q-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 0.8rem;
    }
    .thought-q h3 {
      color: var(--accent);
      font-size: 1.2rem;
      line-height: 1.5;
      margin: 0;
    }
    /* Footer */
    .footer {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.82rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .next-prev {
      display: flex;
      gap: 0.5rem;
    }
    .nav-link {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 0.4rem 0.9rem;
      border-radius: 6px;
      font-size: 0.82rem;
      color: var(--accent);
      text-decoration: none;
    }
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      h2 { font-size: 1.2rem; }
      .divergence-box { grid-template-columns: 1fr; }
      .card-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="day-badge">
    ğŸ“Š é‡åŒ–æ—¥æ¨ Day 9 <span class="phase-tag">Phase 2</span>
  </div>
  <h1>RSI ä¸è¶…ä¹°è¶…å–<br>æ„å»º Mean Reversion ä¿¡å·</h1>
  <p class="subtitle">Relative Strength Index Â· å‡å€¼å›å½’ Â· èƒŒç¦»æ£€æµ‹ Â· é‡åŒ–é™·é˜±</p>
  <div class="meta">
    <span>ğŸ“… 2026-02-26</span>
    <span>â± é˜…è¯»çº¦ 20 åˆ†é’Ÿ</span>
    <span>ğŸ”— æ¥ç»­ Day 8ï¼šç§»åŠ¨å¹³å‡çº¿</span>
    <span>ğŸ Python å®Œæ•´ä»£ç </span>
  </div>
</header>

<!-- TOC -->
<nav class="toc">
  <h3>ğŸ“‹ ç›®å½•</h3>
  <ol>
    <li><a href="#math">RSI æ•°å­¦åŸºç¡€ â€” ä»å…¬å¼åˆ°ä»£ç </a></li>
    <li><a href="#signals">è¶…ä¹°è¶…å–ä¿¡å· â€” 70/30 çš„çœŸç›¸</a></li>
    <li><a href="#strategy">Mean Reversion ç­–ç•¥æ„å»º</a></li>
    <li><a href="#divergence">RSI èƒŒç¦» â€” æ¯”ä¿¡å·æ›´å¯é </a></li>
    <li><a href="#market">è¿æ¥ä»Šæ—¥å¸‚åœº â€” NVDA & SPY å®ä¾‹</a></li>
    <li><a href="#combo">Day 8 å‡çº§ç‰ˆï¼šRSI + EMA ç»„åˆ</a></li>
    <li><a href="#traps">é‡åŒ–é™·é˜± (è¿æ¥ Day 7)</a></li>
    <li><a href="#fullcode">Python å®Œæ•´å›æµ‹ä»£ç </a></li>
  </ol>
</nav>

<!-- Section 1: Math -->
<section id="math">
  <h2><span class="icon">ğŸ§®</span> RSI æ•°å­¦åŸºç¡€</h2>

  <p>RSIï¼ˆRelative Strength Indexï¼Œç›¸å¯¹å¼ºå¼±æŒ‡æ•°ï¼‰ç”± J. Welles Wilder Jr. äº 1978 å¹´åœ¨ã€Šæ–°æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ¦‚å¿µã€‹ä¸­æå‡ºã€‚å®ƒè¡¡é‡çš„æ˜¯<strong>è¿‘æœŸæ¶¨å¹…ä¸è·Œå¹…çš„æ¯”å€¼</strong>ï¼Œå°†å…¶å½’ä¸€åŒ–åˆ° 0-100 åŒºé—´ã€‚</p>

  <div class="formula-box">
    <div class="formula">RSI = 100 âˆ’ 100 / (1 + RS)</div>
    <div class="formula-sub">RS = å¹³å‡æ¶¨å¹… (Avg Gain) / å¹³å‡è·Œå¹… (Avg Loss)</div>
    <div class="formula-note">é»˜è®¤è§‚å¯Ÿå‘¨æœŸï¼šN = 14 å¤©</div>
  </div>

  <h3>Wilder's Smoothing vs. EMA</h3>
  <p>è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¾ˆå¤šæ•™ç¨‹ä¼šè·³è¿‡ï¼šWilder ä½¿ç”¨çš„ä¸æ˜¯æ™®é€šçš„ç®€å•å¹³å‡ï¼Œè€Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„<strong>å¹³æ»‘ç§»åŠ¨å¹³å‡ï¼ˆSmoothed Moving Average, SMMAï¼‰</strong>ã€‚</p>

  <div class="card-grid">
    <div class="card blue">
      <h4>ç¬¬ä¸€ä¸ªå‘¨æœŸï¼ˆåˆå§‹å€¼ï¼‰</h4>
      <p>ç®€å•åœ°å¯¹å‰ 14 å¤©çš„æ¶¨å¹…å’Œè·Œå¹…åˆ†åˆ«å–ç®—æœ¯å¹³å‡ï¼š<br><code>Avg Gainâ‚ = sum(gains[1:15]) / 14</code></p>
    </div>
    <div class="card purple">
      <h4>åç»­å‘¨æœŸï¼ˆWilder å¹³æ»‘ï¼‰</h4>
      <p>ç±»ä¼¼ EMA ä½† Î±=1/Nï¼š<br><code>Avg Gainâ‚™ = (Avg Gainâ‚™â‚‹â‚ Ã— 13 + gainâ‚™) / 14</code><br>ç­‰ä»·äº Î± = 1/14 çš„ EMA</p>
    </div>
  </div>

  <div class="alert info">
    <strong>ğŸ’¡ ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿ</strong>
    ä¸åŒçš„å¹³æ»‘æ–¹å¼ä¼šäº§ç”Ÿä¸åŒçš„ RSI å€¼ã€‚ta-lib å’Œ pandas_ta é»˜è®¤ä½¿ç”¨ Wilder's SMMAï¼Œè€ŒæŸäº›æ•™ç¨‹ä»£ç é”™è¯¯åœ°ä½¿ç”¨ simple rolling meanï¼Œå¯¼è‡´ RSI å€¼å·®è·å¯è¾¾ 5-8 ä¸ªç‚¹ã€‚
  </div>

  <h3>Python ä»é›¶å®ç° RSI</h3>

<pre><code><span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="kw">def</span> <span class="fn">calculate_rsi</span>(prices: pd.Series, period: <span class="fn">int</span> = <span class="nm">14</span>) -> pd.Series:
    <span class="st">"""
    è®¡ç®— RSI (Wilder's Smoothed Moving Average æ–¹æ³•)
    
    Args:
        prices: æ”¶ç›˜ä»·åºåˆ—
        period: å›æº¯å‘¨æœŸ, é»˜è®¤ 14
    Returns:
        RSI åºåˆ— (0-100)
    """</span>
    <span class="cm"># Step 1: è®¡ç®—æ¯æ—¥æ¶¨è·Œå¹…</span>
    delta = prices.diff()
    
    <span class="cm"># Step 2: åˆ†ç¦»æ¶¨å¹…å’Œè·Œå¹…ï¼ˆè·Œå¹…å–ç»å¯¹å€¼ï¼‰</span>
    gain = delta.clip(lower=<span class="nm">0</span>)           <span class="cm"># æ¶¨çš„æ—¶å€™ä¿ç•™ï¼Œè·Œçš„æ—¶å€™ä¸º 0</span>
    loss = (-delta).clip(lower=<span class="nm">0</span>)        <span class="cm"># è·Œçš„æ—¶å€™å–æ­£å€¼ï¼Œæ¶¨çš„æ—¶å€™ä¸º 0</span>
    
    <span class="cm"># Step 3: ç¬¬ä¸€ä¸ªå‘¨æœŸç”¨ç®€å•å¹³å‡ï¼ˆWilder çš„è§„å®šï¼‰</span>
    avg_gain = gain.ewm(
        alpha=<span class="nm">1</span>/period,
        min_periods=period,
        adjust=<span class="nm">False</span>
    ).mean()
    
    avg_loss = loss.ewm(
        alpha=<span class="nm">1</span>/period,
        min_periods=period,
        adjust=<span class="nm">False</span>
    ).mean()
    
    <span class="cm"># Step 4: RS = å¹³å‡æ¶¨å¹… / å¹³å‡è·Œå¹…</span>
    rs = avg_gain / avg_loss
    
    <span class="cm"># Step 5: RSI å…¬å¼</span>
    rsi = <span class="nm">100</span> - (<span class="nm">100</span> / (<span class="nm">1</span> + rs))
    
    <span class="cm"># è¾¹ç•Œå¤„ç†ï¼šavg_loss = 0 æ—¶ RSI = 100</span>
    rsi = rsi.where(avg_loss != <span class="nm">0</span>, <span class="nm">100</span>)
    
    <span class="kw">return</span> rsi


<span class="cm"># ---- æµ‹è¯•ï¼šç”¨éšæœºä»·æ ¼åºåˆ—éªŒè¯ ----</span>
np.random.seed(<span class="nm">42</span>)
prices = pd.Series(<span class="nm">100</span> + np.cumsum(np.random.randn(<span class="nm">100</span>) * <span class="nm">1.5</span>))

rsi = calculate_rsi(prices, period=<span class="nm">14</span>)
<span class="fn">print</span>(rsi.tail(<span class="nm">5</span>).round(<span class="nm">2</span>))
<span class="cm"># è¾“å‡ºèŒƒå›´åº”åœ¨ 0-100 ä¹‹é—´</span>


<span class="cm"># ---- éªŒè¯ï¼šä¸ ta-lib å¯¹æ¯” ----</span>
<span class="kw">try</span>:
    <span class="kw">import</span> talib
    rsi_talib = pd.Series(talib.RSI(prices.values, timeperiod=<span class="nm">14</span>), index=prices.index)
    diff = (rsi - rsi_talib).abs().max()
    <span class="fn">print</span>(<span class="st">f"æœ€å¤§è¯¯å·®: {diff:.6f}"</span>)  <span class="cm"># åº”è¯¥ < 0.001</span>
<span class="kw">except</span>:
    <span class="fn">print</span>(<span class="st">"ta-lib æœªå®‰è£…ï¼Œè·³è¿‡éªŒè¯"</span>)</code></pre>

  <h3>é€æ­¥è®¡ç®—ç¤ºä¾‹</h3>
  <p>ç”¨ 5 å¤©æ•°æ®æ‰‹åŠ¨æ¼”ç®—ï¼Œç†è§£æœºåˆ¶ï¼ˆperiod=5 ç®€åŒ–æ¼”ç¤ºï¼‰ï¼š</p>

  <table>
    <thead>
      <tr><th>Day</th><th>Price</th><th>Change</th><th>Gain</th><th>Loss</th><th>Avg Gain</th><th>Avg Loss</th><th>RS</th><th>RSI</th></tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>100</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
      <tr><td>2</td><td>102</td><td>+2</td><td>2</td><td>0</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
      <tr><td>3</td><td>101</td><td>-1</td><td>0</td><td>1</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
      <tr><td>4</td><td>104</td><td>+3</td><td>3</td><td>0</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
      <tr><td>5</td><td>103</td><td>-1</td><td>0</td><td>1</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
      <tr><td>6</td><td>105</td><td>+2</td><td>2</td><td>0</td><td style="color:var(--accent)">1.40</td><td style="color:var(--red)">0.40</td><td style="color:var(--purple)">3.50</td><td style="color:var(--green);font-weight:700">77.8</td></tr>
    </tbody>
  </table>
  <p style="font-size:0.85rem;color:var(--muted)">Day 6: Avg Gain = (2+0+3+0+2)/5 = 1.4ï¼ŒAvg Loss = (0+1+0+1+0)/5 = 0.4ï¼ŒRS = 3.5ï¼ŒRSI = 100 - 100/4.5 â‰ˆ 77.8ï¼ˆè¶…ä¹°åŒºé—´ï¼ï¼‰</p>
</section>

<!-- Section 2: Signals -->
<section id="signals">
  <h2><span class="icon">ğŸš¦</span> è¶…ä¹°è¶…å–ä¿¡å· â€” 70/30 çš„çœŸç›¸</h2>

  <div class="rsi-gauge">
    <div style="font-size:0.85rem;color:var(--muted);margin-bottom:0.5rem;">RSI åŒºé—´ç¤ºæ„å›¾</div>
    <div class="rsi-bar"></div>
    <div class="rsi-zones">
      <span>0</span><span>20</span><span>30</span><span>50</span><span>70</span><span>80</span><span>100</span>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:0.5rem;">
      <span class="rsi-zone-label oversold">â† è¶…å– Oversold<br>RSI &lt; 30</span>
      <span class="rsi-zone-label neutral" style="text-align:center">ä¸­æ€§åŒºé—´<br>30â€“70</span>
      <span class="rsi-zone-label overbought" style="text-align:right">è¶…ä¹° Overbought â†’<br>RSI &gt; 70</span>
    </div>
  </div>

  <h3>ç»å…¸é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯ 70/30ï¼Ÿ</h3>
  <p>è€å®è¯´ï¼š<strong>70/30 æ˜¯ Wilder å‡­ç»éªŒæ‹çš„</strong>ã€‚ä»–åœ¨ 1978 å¹´æµ‹è¯•äº†å½“æ—¶æœ‰é™çš„å•†å“æœŸè´§æ•°æ®ï¼Œå‘ç°è¿™ä¸¤ä¸ªé˜ˆå€¼åœ¨é‚£äº›å¸‚åœºé‡Œè¡¨ç°ä¸é”™ã€‚å®ƒå¹¶ä¸æ˜¯ä»€ä¹ˆæ•°å­¦æœ€ä¼˜è§£ã€‚</p>

  <div class="alert warning">
    <strong>âš ï¸ é‡è¦è®¤çŸ¥</strong>
    åœ¨ç§‘æŠ€è‚¡ç‰›å¸‚ä¸­ï¼ŒRSI å¯ä»¥<strong>è¿ç»­ 60 å¤šä¸ªäº¤æ˜“æ—¥</strong>ä¿æŒåœ¨ 70 ä»¥ä¸Šï¼ˆè§ 2020-2021 å¹´ NVDAã€TSLA çš„ RSI å†å²ï¼‰ã€‚å¦‚æœä½ åœ¨ RSI=72 æ—¶å°±åšç©ºï¼Œä¼šè¢«è¶‹åŠ¿ç›´æ¥ç¢¾å‹ã€‚
  </div>

  <h3>é€‚åº”æ€§é˜ˆå€¼ï¼šæ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´</h3>
  <p>æ›´èªæ˜çš„åšæ³•æ˜¯æ ¹æ®å¸‚åœºçŠ¶æ€åŠ¨æ€è°ƒæ•´é˜ˆå€¼ï¼š</p>

<pre><code><span class="kw">def</span> <span class="fn">adaptive_rsi_thresholds</span>(rsi: pd.Series, lookback: <span class="fn">int</span> = <span class="nm">252</span>):
    <span class="st">"""
    æ ¹æ®å†å² RSI åˆ†å¸ƒè®¡ç®—è‡ªé€‚åº”é˜ˆå€¼
    ç”¨ 25th percentile ä½œä¸ºè¶…å–çº¿ï¼Œ75th percentile ä½œä¸ºè¶…ä¹°çº¿
    """</span>
    rolling_low  = rsi.rolling(lookback).quantile(<span class="nm">0.25</span>)
    rolling_high = rsi.rolling(lookback).quantile(<span class="nm">0.75</span>)
    
    <span class="kw">return</span> rolling_low, rolling_high


<span class="cm"># åœ¨ç‰›å¸‚ä¸­è‡ªé€‚åº”é˜ˆå€¼å¯èƒ½æ˜¯ 55/75ï¼ˆè€Œéå›ºå®š 30/70ï¼‰</span>
<span class="cm"># åœ¨ç†Šå¸‚ä¸­å¯èƒ½æ˜¯ 25/55</span>
<span class="cm"># è¿™è‡ªåŠ¨åæ˜ äº†å¸‚åœºçš„ regime</span></code></pre>

  <h3>RSI åœ¨ä¸åŒå¸‚åœºçŠ¶æ€ä¸‹çš„è¡Œä¸º</h3>
  <div class="card-grid">
    <div class="card green">
      <h4>ğŸ“ˆ ç‰›å¸‚è¶‹åŠ¿ä¸­</h4>
      <p>RSI åœ¨ 40-80 ä¹‹é—´æŒ¯è¡ã€‚è·Œè‡³ 40 æ˜¯ä¹°å…¥ç‚¹ï¼ˆä¸æ˜¯ 30ï¼‰ã€‚è¿‡æ—©åšç©ºæ˜¯é€é’±è¡Œä¸ºã€‚</p>
    </div>
    <div class="card red">
      <h4>ğŸ“‰ ç†Šå¸‚è¶‹åŠ¿ä¸­</h4>
      <p>RSI åœ¨ 20-60 ä¹‹é—´æŒ¯è¡ã€‚åå¼¹åˆ° 60 æ˜¯å–å‡ºç‚¹ï¼ˆä¸æ˜¯ 70ï¼‰ã€‚å‡å€¼å›å½’åç©ºã€‚</p>
    </div>
    <div class="card yellow">
      <h4>â†”ï¸ éœ‡è¡å¸‚åœºä¸­</h4>
      <p>RSI åœ¨ 30-70 ä¹‹é—´è§„å¾‹æŒ¯è¡ã€‚è¿™æ‰æ˜¯ç»å…¸ 70/30 ç­–ç•¥çœŸæ­£æœ‰æ•ˆçš„ç¯å¢ƒã€‚</p>
    </div>
  </div>
</section>

<!-- Section 3: Strategy -->
<section id="strategy">
  <h2><span class="icon">ğŸ—ï¸</span> Mean Reversion ç­–ç•¥æ„å»º</h2>

  <p><strong>å‡å€¼å›å½’ï¼ˆMean Reversionï¼‰</strong>çš„æ ¸å¿ƒå‡è®¾ï¼šä»·æ ¼çš„æç«¯åç¦»ä¸å¯æŒç»­ï¼Œç»ˆå°†å›å½’å‡å€¼ã€‚RSI æ˜¯é‡åŒ–è¿™ç§"æç«¯ç¨‹åº¦"çš„å·¥å…·ã€‚</p>

  <h3>æœ´ç´ ç­–ç•¥ vs. ç²¾ç»†ç­–ç•¥</h3>

  <div class="card-grid">
    <div class="card red">
      <h4>âŒ æœ´ç´ ç­–ç•¥ï¼ˆå¸¸è§é”™è¯¯ï¼‰</h4>
      <p>RSI è·Œç ´ 30 â†’ ç«‹åˆ»åšå¤š<br>RSI çªç ´ 70 â†’ ç«‹åˆ»åšç©º<br><br>é—®é¢˜ï¼šä½ åœ¨æ¥ä¸‹è½çš„åˆ€å­ã€‚è·Œç ´ 30 çš„è‚¡ç¥¨ç»å¸¸ç»§ç»­è·Œåˆ° 20ã€10ã€‚</p>
    </div>
    <div class="card green">
      <h4>âœ… ç²¾ç»†ç­–ç•¥ï¼ˆç­‰å›å‰ä¿¡å·ï¼‰</h4>
      <p>RSI è·Œç ´ 30 å<strong>é‡æ–°ä¸Šç©¿ 30</strong> â†’ åšå¤š<br>RSI çªç ´ 70 å<strong>é‡æ–°ä¸‹ç©¿ 70</strong> â†’ åšç©º<br><br>åŸå› ï¼šç­‰å¾…å›å‰ç¡®è®¤åŠ¨é‡å·²åè½¬ï¼Œä¸æ˜¯åœ¨çŒœåº•éƒ¨ã€‚</p>
    </div>
  </div>

  <h3>ç­–ç•¥æ‰§è¡Œæ­¥éª¤</h3>
  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <strong>ç›‘æµ‹ RSI è¿›å…¥æç«¯åŒºé—´</strong>
        <p>RSI &lt; 30ï¼šè¿›å…¥"å¾…è§‚å¯Ÿ"çŠ¶æ€ã€‚æ³¨æ„ï¼šè¿˜ä¸æ˜¯å…¥åœºä¿¡å·ã€‚</p>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <strong>ç­‰å¾…å›å‰ç¡®è®¤</strong>
        <p>RSI ä» &lt; 30 å›å‡å¹¶ä¸Šç©¿ 30 â†’ <strong>åšå¤šä¿¡å·</strong>ã€‚æ­¤æ—¶åŠ¨é‡å·²åœ¨è½¬å˜ï¼Œé£é™©é™ä½ã€‚</p>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <strong>è®¾ç½®æ­¢æŸå’Œç›®æ ‡</strong>
        <p>æ­¢æŸï¼šRSI å†æ¬¡è·Œç ´ 25ï¼ˆæç«¯æ¶åŒ–ï¼‰ã€‚ç›®æ ‡ï¼šRSI å›åˆ° 50 ä¸­çº¿ï¼ˆå‡å€¼å®Œæˆå›å½’ï¼‰ã€‚</p>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <strong>é€€å‡ºæœºåˆ¶</strong>
        <p>RSI è¾¾åˆ° 50 ä¸­çº¿ â†’ å¹³ä»“ä¸€åŠï¼›RSI è¾¾åˆ° 60 â†’ å…¨éƒ¨å¹³ä»“ã€‚ä¸è´ªå©ªï¼Œå‡å€¼å›å½’ç­–ç•¥æ˜¯åƒå°é±¼çš„ã€‚</p>
      </div>
    </div>
  </div>

  <h3>Pure Pandas å›æµ‹ä»£ç ï¼ˆåŸºç¡€ç‰ˆï¼‰</h3>

<pre><code><span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> yfinance <span class="kw">as</span> yf

<span class="kw">def</span> <span class="fn">rsi_mean_reversion_backtest</span>(
    ticker: <span class="fn">str</span> = <span class="st">"SPY"</span>,
    start: <span class="fn">str</span> = <span class="st">"2020-01-01"</span>,
    end: <span class="fn">str</span> = <span class="st">"2025-01-01"</span>,
    rsi_period: <span class="fn">int</span> = <span class="nm">14</span>,
    oversold: <span class="fn">int</span> = <span class="nm">30</span>,
    overbought: <span class="fn">int</span> = <span class="nm">70</span>
) -> dict:
    
    <span class="cm"># ä¸‹è½½æ•°æ®</span>
    df = yf.download(ticker, start=start, end=end, progress=<span class="nm">False</span>)
    df = df[<span class="st">'Close'</span>].squeeze()
    
    <span class="cm"># è®¡ç®— RSI</span>
    delta = df.diff()
    gain = delta.clip(lower=<span class="nm">0</span>)
    loss = (-delta).clip(lower=<span class="nm">0</span>)
    avg_gain = gain.ewm(alpha=<span class="nm">1</span>/rsi_period, adjust=<span class="nm">False</span>).mean()
    avg_loss = loss.ewm(alpha=<span class="nm">1</span>/rsi_period, adjust=<span class="nm">False</span>).mean()
    rs = avg_gain / avg_loss
    rsi = <span class="nm">100</span> - (<span class="nm">100</span> / (<span class="nm">1</span> + rs))
    
    <span class="cm"># ç”Ÿæˆ"å›å‰"ä¿¡å·ï¼ˆç­‰ RSI ç©¿è¶Šé˜ˆå€¼åç¡®è®¤ï¼‰</span>
    prev_rsi = rsi.shift(<span class="nm">1</span>)
    
    <span class="cm"># åšå¤šä¿¡å·ï¼šä¸Šä¸€å¤© RSI < 30ï¼Œä»Šå¤© RSI >= 30ï¼ˆä¸Šç©¿ï¼‰</span>
    long_signal  = (prev_rsi < oversold)  & (rsi >= oversold)
    <span class="cm"># åšç©ºä¿¡å·ï¼šä¸Šä¸€å¤© RSI > 70ï¼Œä»Šå¤© RSI <= 70ï¼ˆä¸‹ç©¿ï¼‰</span>
    short_signal = (prev_rsi > overbought) & (rsi <= overbought)
    
    <span class="cm"># æ„å»ºæŒä»“ï¼š1 = å¤šï¼Œ-1 = ç©ºï¼Œ0 = ç©ºä»“</span>
    <span class="cm"># ç­–ç•¥ï¼šæŒæœ‰åˆ° RSI å›åˆ° 50ï¼ˆä¸­çº¿ï¼‰</span>
    position = pd.Series(<span class="nm">0</span>, index=df.index)
    current_pos = <span class="nm">0</span>
    
    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="nm">1</span>, <span class="fn">len</span>(df)):
        <span class="kw">if</span> long_signal.iloc[i]:
            current_pos = <span class="nm">1</span>
        <span class="kw">elif</span> short_signal.iloc[i]:
            current_pos = -<span class="nm">1</span>
        <span class="cm"># é€€å‡ºï¼šRSI ç©¿è¿‡ 50 ä¸­çº¿</span>
        <span class="kw">elif</span> current_pos == <span class="nm">1</span>  <span class="kw">and</span> rsi.iloc[i] > <span class="nm">50</span>:
            current_pos = <span class="nm">0</span>
        <span class="kw">elif</span> current_pos == -<span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] < <span class="nm">50</span>:
            current_pos = <span class="nm">0</span>
        position.iloc[i] = current_pos
    
    <span class="cm"># è®¡ç®—æ¯æ—¥æ”¶ç›Š</span>
    daily_returns = df.pct_change()
    strategy_returns = position.shift(<span class="nm">1</span>) * daily_returns  <span class="cm"># æ³¨æ„ï¼šä¿¡å·åœ¨ä»Šå¤©ï¼Œæ˜å¤©æ‰èƒ½æ‰§è¡Œ</span>
    
    <span class="cm"># ä¸šç»©ç»Ÿè®¡</span>
    total_return = ((<span class="nm">1</span> + strategy_returns).cumprod().iloc[-<span class="nm">1</span>] - <span class="nm">1</span>) * <span class="nm">100</span>
    bh_return = ((df.iloc[-<span class="nm">1</span>] / df.iloc[<span class="nm">0</span>]) - <span class="nm">1</span>) * <span class="nm">100</span>
    
    <span class="cm"># Sharpe Ratioï¼ˆå¹´åŒ–ï¼Œå‡è®¾æ— é£é™©åˆ©ç‡ 5%ï¼‰</span>
    excess = strategy_returns - <span class="nm">0.05</span>/<span class="nm">252</span>
    sharpe = excess.mean() / excess.std() * np.sqrt(<span class="nm">252</span>)
    
    <span class="cm"># æœ€å¤§å›æ’¤</span>
    cumulative = (<span class="nm">1</span> + strategy_returns).cumprod()
    peak = cumulative.expanding().max()
    drawdown = (cumulative - peak) / peak
    max_dd = drawdown.min() * <span class="nm">100</span>
    
    <span class="cm"># èƒœç‡</span>
    trades = strategy_returns[position.shift(<span class="nm">1</span>) != <span class="nm">0</span>]
    win_rate = (trades > <span class="nm">0</span>).mean() * <span class="nm">100</span>
    
    results = {
        <span class="st">"strategy_return"</span>: <span class="fn">round</span>(total_return, <span class="nm">2</span>),
        <span class="st">"buy_hold_return"</span>: <span class="fn">round</span>(bh_return, <span class="nm">2</span>),
        <span class="st">"sharpe_ratio"</span>:    <span class="fn">round</span>(sharpe, <span class="nm">3</span>),
        <span class="st">"max_drawdown"</span>:    <span class="fn">round</span>(max_dd, <span class="nm">2</span>),
        <span class="st">"win_rate"</span>:        <span class="fn">round</span>(win_rate, <span class="nm">1</span>),
        <span class="st">"equity_curve"</span>:   cumulative
    }
    <span class="kw">return</span> results

<span class="cm"># è¿è¡Œ</span>
results = <span class="fn">rsi_mean_reversion_backtest</span>(<span class="st">"SPY"</span>)
<span class="fn">print</span>(<span class="st">f"ç­–ç•¥æ”¶ç›Š: {results['strategy_return']}%"</span>)
<span class="fn">print</span>(<span class="st">f"ä¹°å…¥æŒæœ‰: {results['buy_hold_return']}%"</span>)
<span class="fn">print</span>(<span class="st">f"Sharpe:   {results['sharpe_ratio']}"</span>)
<span class="fn">print</span>(<span class="st">f"æœ€å¤§å›æ’¤: {results['max_drawdown']}%"</span>)
<span class="fn">print</span>(<span class="st">f"èƒœç‡:     {results['win_rate']}%"</span>)</code></pre>

  <div class="alert warning">
    <strong>âš ï¸ åŠ¨é‡è¦†ç›–å‡å€¼å›å½’çš„é£é™©</strong>
    2022 å¹´ç†Šå¸‚ä¸­ï¼ŒSPY çš„ RSI å¤šæ¬¡åœ¨ 30 é™„è¿‘ç»™å‡º"ä¹°å…¥"ä¿¡å·ï¼Œä½†ä»·æ ¼ç»§ç»­ä¸‹è·Œ 15-20%ã€‚å¼ºçƒˆçš„å®è§‚è¶‹åŠ¿ï¼ˆFed åŠ æ¯ï¼‰ä¼šæŒç»­è¦†ç›–æŠ€æœ¯é¢çš„å‡å€¼å›å½’ä¿¡å·ã€‚<strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆçº¯ RSI ç­–ç•¥éœ€è¦é…åˆè¶‹åŠ¿è¿‡æ»¤</strong>ï¼ˆè§ Section 6ï¼‰ã€‚
  </div>
</section>

<!-- Section 4: Divergence -->
<section id="divergence">
  <h2><span class="icon">ğŸ”±</span> RSI èƒŒç¦» â€” æ¯”ä¿¡å·æ›´å¯é </h2>

  <p>RSI èƒŒç¦»ï¼ˆDivergenceï¼‰æ˜¯ RSI åˆ†æä¸­æœ€ç²¾åçš„éƒ¨åˆ†ã€‚å®ƒå…³æ³¨çš„ä¸æ˜¯ RSI çš„ç»å¯¹å€¼ï¼Œè€Œæ˜¯<strong>ä»·æ ¼èµ°åŠ¿ä¸ RSI èµ°åŠ¿ä¹‹é—´çš„åˆ†æ­§</strong>â€”â€”å½“è¿™ä¸¤è€…æ–¹å‘ç›¸åæ—¶ï¼Œå¾€å¾€é¢„ç¤ºç€è¶‹åŠ¿çš„ç–²è½¯æˆ–åè½¬ã€‚</p>

  <div class="divergence-box">
    <div class="div-card bullish">
      <h4>ğŸ“— çœ‹æ¶¨èƒŒç¦» (Bullish Divergence)</h4>
      <div class="signal-row">
        <span class="label">ä»·æ ¼èµ°åŠ¿</span>
        <span class="val down">ä½ç‚¹ â†’ æ›´ä½ä½ç‚¹ â†˜</span>
      </div>
      <div class="signal-row">
        <span class="label">RSI èµ°åŠ¿</span>
        <span class="val up">ä½ç‚¹ â†’ æ›´é«˜ä½ç‚¹ â†—</span>
      </div>
      <div class="signal-row">
        <span class="label">å«ä¹‰</span>
        <span class="val up">ä¸‹è·ŒåŠ¨èƒ½æ­£åœ¨å‡å¼±</span>
      </div>
      <div class="signal-row">
        <span class="label">æ“ä½œ</span>
        <span class="val up">å…³æ³¨åšå¤šæœºä¼š</span>
      </div>
      <p style="margin-top:0.8rem;font-size:0.82rem;color:var(--muted)">
        å…¸å‹æ¡ˆä¾‹ï¼š2020å¹´3æœˆï¼ŒSPY åœ¨åˆ›æ–°ä½ï¼Œä½† RSI æ²¡æœ‰åŒæ­¥åˆ›æ–°ä½ â†’ åå¼¹ç¡®è®¤
      </p>
    </div>
    <div class="div-card bearish">
      <h4>ğŸ“• çœ‹è·ŒèƒŒç¦» (Bearish Divergence)</h4>
      <div class="signal-row">
        <span class="label">ä»·æ ¼èµ°åŠ¿</span>
        <span class="val up">é«˜ç‚¹ â†’ æ›´é«˜é«˜ç‚¹ â†—</span>
      </div>
      <div class="signal-row">
        <span class="label">RSI èµ°åŠ¿</span>
        <span class="val down">é«˜ç‚¹ â†’ æ›´ä½é«˜ç‚¹ â†˜</span>
      </div>
      <div class="signal-row">
        <span class="label">å«ä¹‰</span>
        <span class="val down">ä¸Šæ¶¨åŠ¨èƒ½æ­£åœ¨è¡°ç«­</span>
      </div>
      <div class="signal-row">
        <span class="label">æ“ä½œ</span>
        <span class="val down">å…³æ³¨å‡ä»“/åšç©ºæœºä¼š</span>
      </div>
      <p style="margin-top:0.8rem;font-size:0.82rem;color:var(--muted)">
        å…¸å‹æ¡ˆä¾‹ï¼š2021å¹´11æœˆï¼ŒSPY åˆ›å†å²æ–°é«˜ï¼Œä½† RSI åœ¨ä¸‹é™ â†’ é¢„ç¤º 2022 å¹´ç†Šå¸‚
      </p>
    </div>
  </div>

  <h3>Python ä»£ç ï¼šè‡ªåŠ¨æ£€æµ‹ RSI èƒŒç¦»</h3>

<pre><code><span class="kw">from</span> scipy.signal <span class="kw">import</span> argrelextrema

<span class="kw">def</span> <span class="fn">find_divergence</span>(
    price: pd.Series,
    rsi: pd.Series,
    order: <span class="fn">int</span> = <span class="nm">5</span>,       <span class="cm"># å±€éƒ¨æå€¼çš„é‚»åŸŸå¤§å°</span>
    lookback: <span class="fn">int</span> = <span class="nm">50</span>    <span class="cm"># ä»…æ£€æµ‹æœ€è¿‘ N æ ¹ bar</span>
) -> pd.DataFrame:
    <span class="st">"""
    æ£€æµ‹ RSI èƒŒç¦»ä¿¡å·
    
    åŸç†ï¼šæ‰¾åˆ°ä»·æ ¼çš„å±€éƒ¨æå€¼ç‚¹ï¼Œå¯¹æ¯”å¯¹åº”çš„ RSI æå€¼
    æ³¨æ„ï¼šè¿™é‡Œæœ‰æ½œåœ¨çš„ look-ahead biasï¼Œè§ä¸‹æ–¹è¯´æ˜
    """</span>
    
    price_arr = price.values
    rsi_arr   = rsi.values
    n = <span class="fn">len</span>(price_arr)
    
    <span class="cm"># æ‰¾å±€éƒ¨ä½ç‚¹ï¼ˆfor bullish divergenceï¼‰</span>
    local_lows  = argrelextrema(price_arr, np.less, order=order)[<span class="nm">0</span>]
    <span class="cm"># æ‰¾å±€éƒ¨é«˜ç‚¹ï¼ˆfor bearish divergenceï¼‰</span>
    local_highs = argrelextrema(price_arr, np.greater, order=order)[<span class="nm">0</span>]
    
    signals = []
    
    <span class="cm"># æ£€æµ‹çœ‹æ¶¨èƒŒç¦»</span>
    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="nm">1</span>, <span class="fn">len</span>(local_lows)):
        idx1, idx2 = local_lows[i-<span class="nm">1</span>], local_lows[i]
        <span class="kw">if</span> idx2 - idx1 > lookback:
            <span class="kw">continue</span>
        
        <span class="cm"># ä»·æ ¼åˆ›æ–°ä½ï¼ŒRSI æ²¡æœ‰åˆ›æ–°ä½ â†’ çœ‹æ¶¨èƒŒç¦»</span>
        price_lower = price_arr[idx2] < price_arr[idx1]
        rsi_higher  = rsi_arr[idx2]   > rsi_arr[idx1]
        
        <span class="kw">if</span> price_lower <span class="kw">and</span> rsi_higher:
            signals.append({
                <span class="st">'date'</span>:  price.index[idx2],
                <span class="st">'type'</span>:  <span class="st">'bullish'</span>,
                <span class="st">'price'</span>: price_arr[idx2],
                <span class="st">'rsi'</span>:   rsi_arr[idx2],
                <span class="st">'prev_price'</span>: price_arr[idx1],
                <span class="st">'prev_rsi'</span>:   rsi_arr[idx1],
            })
    
    <span class="cm"># æ£€æµ‹çœ‹è·ŒèƒŒç¦»</span>
    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="nm">1</span>, <span class="fn">len</span>(local_highs)):
        idx1, idx2 = local_highs[i-<span class="nm">1</span>], local_highs[i]
        <span class="kw">if</span> idx2 - idx1 > lookback:
            <span class="kw">continue</span>
        
        <span class="cm"># ä»·æ ¼åˆ›æ–°é«˜ï¼ŒRSI æ²¡æœ‰åˆ›æ–°é«˜ â†’ çœ‹è·ŒèƒŒç¦»</span>
        price_higher = price_arr[idx2] > price_arr[idx1]
        rsi_lower    = rsi_arr[idx2]   < rsi_arr[idx1]
        
        <span class="kw">if</span> price_higher <span class="kw">and</span> rsi_lower:
            signals.append({
                <span class="st">'date'</span>:  price.index[idx2],
                <span class="st">'type'</span>:  <span class="st">'bearish'</span>,
                <span class="st">'price'</span>: price_arr[idx2],
                <span class="st">'rsi'</span>:   rsi_arr[idx2],
                <span class="st">'prev_price'</span>: price_arr[idx1],
                <span class="st">'prev_rsi'</span>:   rsi_arr[idx1],
            })
    
    <span class="kw">return</span> pd.DataFrame(signals).sort_values(<span class="st">'date'</span>)


<span class="cm"># âš ï¸ é‡è¦ï¼šargrelextrema ä¼šä½¿ç”¨"æœªæ¥"æ•°æ®æ¥ç¡®è®¤å½“å‰æå€¼ç‚¹</span>
<span class="cm"># è¿™æ˜¯ä¸€ç§ look-ahead biasï¼å®ç›˜å¿…é¡»åªç”¨å·¦ä¾§æ•°æ®æ¥è¯†åˆ«æå€¼</span>
<span class="cm"># è§ Section 7 é™·é˜± #2</span></code></pre>

  <div class="alert info">
    <strong>ğŸ’¡ ä¸ºä»€ä¹ˆèƒŒç¦»æ¯”ç»å¯¹å€¼æ›´å¯é ï¼Ÿ</strong>
    èƒŒç¦»ä¿¡å·å…³æ³¨çš„æ˜¯"åŠ¨é‡è¡°å‡"ï¼Œè€Œä¸æ˜¯"ä»·æ ¼å·²ç»è·Œå¤Ÿäº†"ã€‚åŠ¨é‡å…ˆäºä»·æ ¼å˜åŒ–â€”â€”è¿™æ˜¯æŠ€æœ¯åˆ†æé‡Œå°‘æœ‰çš„æœ‰ç‰©ç†ç›´è§‰æ”¯æ’‘çš„è§„å¾‹ã€‚
  </div>
</section>

<!-- Section 5: Market -->
<section id="market">
  <h2><span class="icon">ğŸŒ</span> è¿æ¥ä»Šæ—¥å¸‚åœº â€” NVDA & SPY å®ä¾‹</h2>

  <p>ç†è®ºå¾ˆå¥½ï¼Œä½†é‡åŒ–éœ€è¦è¿æ¥çœŸå®å¸‚åœºã€‚è®©æˆ‘ä»¬çœ‹çœ‹ 2026 å¹´ 2 æœˆä¸‹æ—¬å¸‚åœºçš„ RSI çŠ¶æ€ã€‚</p>

  <div class="market-card">
    <div class="ticker">
      <span class="symbol">NVDA</span>
      <span class="name">Nvidia Corporation â€” è´¢æŠ¥å‰åçš„ RSI åˆ†æ</span>
    </div>
    <div class="metric-row">
      <div class="metric">
        <span class="key">è´¢æŠ¥å‰ RSI (çº¦ 2 å‘¨å‰)</span>
        <span class="val overbought">~72-78</span>
      </div>
      <div class="metric">
        <span class="key">è´¢æŠ¥å RSI</span>
        <span class="val neutral">~48-55</span>
      </div>
      <div class="metric">
        <span class="key">ä¿¡å·çŠ¶æ€</span>
        <span class="val overbought">è¶…ä¹° â†’ å¿«é€Ÿé™æ¸©</span>
      </div>
    </div>
    <div style="margin-top:1rem;font-size:0.88rem;color:var(--muted);">
      <strong style="color:var(--text);">åˆ†æï¼š</strong> NVDA åœ¨è´¢æŠ¥å‰å‡ å‘¨å—åˆ° AI çƒ­æ½®é©±åŠ¨ï¼ŒRSI é•¿æœŸå¤„äºè¶…ä¹°åŒºåŸŸï¼ˆ70+ï¼‰ã€‚è¿™æ˜¯å…¸å‹çš„"å¼ºåŠ¿è‚¡çš„è¶…ä¹°"â€”â€”è¶‹åŠ¿ä¸­è¶…ä¹°å¯ä»¥æŒç»­ç»´æŒï¼Œç›´åˆ°è§¦å‘äº‹ä»¶ï¼ˆè´¢æŠ¥ã€å®è§‚æ–°é—»ï¼‰ã€‚è´¢æŠ¥å‘å¸ƒåï¼ŒRSI è¿…é€Ÿä»è¶…ä¹°åŒºå›è½è‡³ä¸­æ€§ã€‚è¿™éªŒè¯äº† Day 8 çš„ç»“è®ºï¼š<em>åœ¨å¼ºè¶‹åŠ¿ä¸­ï¼ŒRSI > 70 ä¸æ˜¯å–å‡ºä¿¡å·ï¼Œè€Œæ˜¯å¼ºåŠ¿çš„è¡¨ç°</em>ã€‚
    </div>
  </div>

  <div class="market-card">
    <div class="ticker">
      <span class="symbol">SPY</span>
      <span class="name">S&P 500 ETF â€” 2 æœˆ 23 æ—¥ -1% åçš„ RSI</span>
    </div>
    <div class="metric-row">
      <div class="metric">
        <span class="key">å½“å‰ RSI (14æ—¥)</span>
        <span class="val neutral">~42-48</span>
      </div>
      <div class="metric">
        <span class="key">è·è¶…å–çº¿</span>
        <span class="val neutral">ä»æœ‰è·ç¦»</span>
      </div>
      <div class="metric">
        <span class="key">ç­–ç•¥ä¿¡å·</span>
        <span class="val neutral">ä¸­æ€§ï¼Œè§‚æœ›</span>
      </div>
    </div>
    <div style="margin-top:1rem;font-size:0.88rem;color:var(--muted);">
      <strong style="color:var(--text);">åˆ†æï¼š</strong> 2 æœˆ 23 æ—¥ SPY ä¸‹è·Œçº¦ 1%ï¼Œå åŠ ä¹‹å‰çš„å›è°ƒï¼ŒRSI ä»é«˜ä½é™è‡³ä¸­æ€§åå¼±åŒºé—´ï¼ˆ~45ï¼‰ã€‚æ ¹æ®æˆ‘ä»¬çš„ç­–ç•¥ï¼Œè¿™è¿˜æœªè§¦å‘åšå¤šä¿¡å·ï¼ˆéœ€è¦è·Œç ´ 30 åå›å‰ï¼‰ã€‚è¿™æ­£æ˜¯"è€å¿ƒç­‰å¾…ä¿¡å·ç¡®è®¤"çš„ä½“ç°â€”â€”ä¸è¦è¿½è·Œï¼Œç­‰ RSI ç»™å‡ºæ˜ç¡®çš„è¶…å–+å›å‰ä¿¡å·ã€‚
    </div>
  </div>

  <div class="alert success">
    <strong>ğŸ“Š å®æˆ˜å»ºè®®</strong>
    è·å–å®æ—¶ RSI æ•°æ®ï¼šè¿è¡Œ <code>yf.download("SPY", period="3mo")</code> ç„¶åè®¡ç®— RSIã€‚æˆ–ä½¿ç”¨å…è´¹ APIï¼šTradingViewã€Finviz éƒ½æä¾›å¯è§†åŒ– RSIï¼Œæ–¹ä¾¿å¿«é€Ÿå‚è€ƒã€‚
  </div>
</section>

<!-- Section 6: Combo -->
<section id="combo">
  <h2><span class="icon">ğŸ”—</span> Day 8 å‡çº§ç‰ˆï¼šRSI + EMA ç»„åˆç­–ç•¥</h2>

  <p>ä¸Šä¸€æœŸæˆ‘ä»¬å­¦äº†ç§»åŠ¨å¹³å‡çº¿ï¼ˆEMA/SMAï¼‰ã€‚ä»Šå¤©çš„ RSI ä¸å®ƒå®Œç¾æ­é…ï¼Œå½¢æˆä¸€ä¸ªåŒé‡è¿‡æ»¤æœºåˆ¶ï¼š</p>

  <div class="connection-box">
    <h4>ğŸ§  ç»„åˆé€»è¾‘ï¼šè¶‹åŠ¿è¿‡æ»¤ + åŠ¨é‡è¶…å–</h4>
    <p>
      <strong>å…¥åœºæ¡ä»¶ï¼ˆåšå¤šï¼‰ï¼š</strong><br>
      â‘  RSI è·Œç ´ 30 åå›å‰ä¸Šç©¿ï¼ˆè¶…å–ä¿¡å·ï¼‰<br>
      â‘¡ ä»·æ ¼ä»åœ¨ 200 æ—¥ EMA ä¹‹ä¸Šï¼ˆé•¿æœŸè¶‹åŠ¿ä¸ºå¤šï¼‰<br>
      â†’ ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ‰å…¥åœºï¼Œå¦åˆ™å¿½ç•¥ä¿¡å·
    </p>
    <p style="margin-top:0.8rem;">
      <strong>é€»è¾‘ï¼š</strong>å¦‚æœä»·æ ¼åœ¨ 200 EMA ä¹‹ä¸‹ï¼Œè¯´æ˜é•¿æœŸè¶‹åŠ¿ä¸ºç©ºï¼ŒRSI è¶…å–åªæ˜¯ä¸‹è·Œé€”ä¸­çš„çŸ­æš‚å–˜æ¯ï¼Œä¸é€‚åˆåšå¤šçš„å‡å€¼å›å½’ã€‚è¿™å¤§å¹…é™ä½äº† 2022 å¹´è¿™ç±»ç†Šå¸‚ä¸­çš„å‡ä¿¡å·ã€‚
    </p>
  </div>

<pre><code><span class="kw">def</span> <span class="fn">rsi_ema_combo_strategy</span>(
    ticker: <span class="fn">str</span> = <span class="st">"SPY"</span>,
    start: <span class="fn">str</span> = <span class="st">"2020-01-01"</span>,
    end: <span class="fn">str</span> = <span class="st">"2025-01-01"</span>
) -> dict:
    
    df = yf.download(ticker, start=start, end=end, progress=<span class="nm">False</span>)[<span class="st">'Close'</span>].squeeze()
    
    <span class="cm"># è®¡ç®—æŒ‡æ ‡</span>
    rsi   = calculate_rsi(df, period=<span class="nm">14</span>)
    ema50  = df.ewm(span=<span class="nm">50</span>,  adjust=<span class="nm">False</span>).mean()
    ema200 = df.ewm(span=<span class="nm">200</span>, adjust=<span class="nm">False</span>).mean()
    
    <span class="cm"># è¶‹åŠ¿è¿‡æ»¤ï¼šä»·æ ¼åœ¨ 200 EMA ä¸Šæ–¹ â†’ å…è®¸åšå¤š</span>
    uptrend = df > ema200
    
    <span class="cm"># ä¿¡å·ç”Ÿæˆï¼ˆå›å‰ï¼‰</span>
    prev_rsi = rsi.shift(<span class="nm">1</span>)
    rsi_cross_up   = (prev_rsi < <span class="nm">30</span>) & (rsi >= <span class="nm">30</span>)  <span class="cm"># ä¸Šç©¿ 30</span>
    rsi_cross_down = (prev_rsi > <span class="nm">70</span>) & (rsi <= <span class="nm">70</span>)  <span class="cm"># ä¸‹ç©¿ 70</span>
    
    <span class="cm"># ç»„åˆä¿¡å·ï¼šRSI ä¿¡å· + è¶‹åŠ¿è¿‡æ»¤</span>
    long_signal  = rsi_cross_up   & uptrend          <span class="cm"># å¤šå¤´ä¿¡å·ï¼ˆéœ€åœ¨ EMA200 ä¸Šæ–¹ï¼‰</span>
    short_signal = rsi_cross_down & ~uptrend         <span class="cm"># ç©ºå¤´ä¿¡å·ï¼ˆéœ€åœ¨ EMA200 ä¸‹æ–¹ï¼‰</span>
    
    <span class="cm"># æŒä»“é€»è¾‘ï¼ˆåŒä¸Šï¼Œé€€å‡ºåœ¨ RSI=50ï¼‰</span>
    position = pd.Series(<span class="nm">0</span>, index=df.index)
    current_pos = <span class="nm">0</span>
    
    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="nm">1</span>, <span class="fn">len</span>(df)):
        <span class="kw">if</span> long_signal.iloc[i]:
            current_pos = <span class="nm">1</span>
        <span class="kw">elif</span> short_signal.iloc[i]:
            current_pos = -<span class="nm">1</span>
        <span class="kw">elif</span> current_pos == <span class="nm">1</span>  <span class="kw">and</span> rsi.iloc[i] > <span class="nm">50</span>:
            current_pos = <span class="nm">0</span>
        <span class="kw">elif</span> current_pos == -<span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] < <span class="nm">50</span>:
            current_pos = <span class="nm">0</span>
        position.iloc[i] = current_pos
    
    <span class="cm"># è®¡ç®—ç»©æ•ˆï¼ˆåŒä¸Šï¼‰</span>
    daily_ret = df.pct_change()
    strat_ret = position.shift(<span class="nm">1</span>) * daily_ret
    
    sharpe = (strat_ret.mean() - <span class="nm">0.05</span>/<span class="nm">252</span>) / strat_ret.std() * np.sqrt(<span class="nm">252</span>)
    total  = (<span class="nm">1</span> + strat_ret).cumprod()
    
    <span class="kw">return</span> {
        <span class="st">"strategy"</span>: <span class="st">"RSI + EMA200 Filter"</span>,
        <span class="st">"sharpe"</span>: <span class="fn">round</span>(sharpe, <span class="nm">3</span>),
        <span class="st">"total_return"</span>: <span class="fn">round</span>((total.iloc[-<span class="nm">1</span>] - <span class="nm">1</span>) * <span class="nm">100</span>, <span class="nm">2</span>),
        <span class="st">"max_dd"</span>: <span class="fn">round</span>(((total/total.expanding().max()-<span class="nm">1</span>).min())*<span class="nm">100</span>, <span class="nm">2</span>)
    }

results_combo = <span class="fn">rsi_ema_combo_strategy</span>()
<span class="fn">print</span>(results_combo)
<span class="cm"># é¢„æœŸï¼šæ¯”çº¯ RSI ç­–ç•¥æœ‰æ›´é«˜ Sharpe å’Œæ›´ä½æœ€å¤§å›æ’¤</span></code></pre>

  <table>
    <thead>
      <tr><th>ç­–ç•¥</th><th>Sharpeï¼ˆé¢„æœŸå‚è€ƒï¼‰</th><th>æœ€å¤§å›æ’¤ï¼ˆé¢„æœŸï¼‰</th><th>å¤‡æ³¨</th></tr>
    </thead>
    <tbody>
      <tr><td>çº¯ RSI å‡å€¼å›å½’</td><td>0.3 ~ 0.6</td><td>-15% ~ -25%</td><td>2022 å¹´åƒå¤§äº</td></tr>
      <tr><td>RSI + EMA200 è¿‡æ»¤</td><td>0.5 ~ 0.9</td><td>-10% ~ -18%</td><td>å¤§å¹…å‡å°‘ç†Šå¸‚æŸå¤±</td></tr>
      <tr><td>Buy & Hold SPY</td><td>0.7 ~ 1.0</td><td>-33.9% (2020)</td><td>åŸºå‡†çº¿</td></tr>
    </tbody>
  </table>
</section>

<!-- Section 7: Traps -->
<section id="traps">
  <h2><span class="icon">âš ï¸</span> é‡åŒ–é™·é˜± â€” è¿æ¥ Day 7</h2>

  <p>Day 7 æˆ‘ä»¬å­¦äº†å›æµ‹é™·é˜±çš„é€šç”¨æ¡†æ¶ã€‚ä»Šå¤©æŠŠå®ƒå…·ä½“åŒ–åˆ° RSI ç­–ç•¥ä¸Šã€‚</p>

  <ul class="trap-list">
    <li class="trap-item">
      <div class="trap-title">é™·é˜± #1ï¼šè¿‡æ‹Ÿåˆ RSI é˜ˆå€¼</div>
      <p>ä½ åœ¨å†å²æ•°æ®ä¸Šå‘ç°"RSI=28 ä¹°å…¥ã€RSI=68 å–å‡º"æ¯”é»˜è®¤ 30/70 å¥½ 15%ã€‚ä½†è¿™ä¸ªå·®è·æ˜¯å™ªå£°ï¼Œä¸æ˜¯ä¿¡å·ã€‚åœ¨æ–°çš„æ•°æ®ä¸Šï¼Œ28 å’Œ 30 çš„å·®åˆ«å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½ åªæ˜¯åœ¨è®°å¿†å†å²å™ªå£°ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¿æŒé»˜è®¤å€¼ï¼ˆ30/70ï¼‰ï¼Œæˆ–åš walk-forward éªŒè¯ï¼›åƒä¸‡ä¸è¦åœ¨åŒä¸€æ•°æ®é›†ä¸ŠåŒæ—¶ä¼˜åŒ–å’ŒéªŒè¯å‚æ•°ã€‚</p>
    </li>
    <li class="trap-item">
      <div class="trap-title">é™·é˜± #2ï¼šèƒŒç¦»æ£€æµ‹çš„ Look-ahead Bias</div>
      <p>ç”¨ <code>argrelextrema</code> æ£€æµ‹å±€éƒ¨ä½ç‚¹éœ€è¦"æœªæ¥"æ•°æ®â€”â€”ä¸€ä¸ªä½ç‚¹åœ¨å®ƒä¹‹åå‡ å¤©éƒ½æ²¡å‡ºç°æ›´ä½çš„ç‚¹æ‰èƒ½è¢«ç¡®è®¤ä¸ºå±€éƒ¨ä½ç‚¹ã€‚åœ¨å®ç›˜ä¸­ä½ ä¸çŸ¥é“è¿™ä¸ªä¿¡æ¯ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå®ç›˜ä¸­ç”¨"å®æ—¶"ä½ç‚¹è¯†åˆ«ï¼ˆå¦‚ä»·æ ¼è¿ç»­ N å¤©åå¼¹è§†ä¸ºä½ç‚¹å·²ç¡®è®¤ï¼‰ï¼Œè€Œä¸æ˜¯æœ€ä¼˜æå€¼æ£€æµ‹ã€‚</p>
    </li>
    <li class="trap-item">
      <div class="trap-title">é™·é˜± #3ï¼šé”™è¯¯çš„æŒä»“ä¿¡å·åç§»</div>
      <p>å¸¸è§é”™è¯¯ï¼š<code>daily_returns * position</code>ï¼ˆæ²¡æœ‰ shiftï¼‰ã€‚ä»Šå¤©æ”¶ç›˜äº§ç”Ÿä¿¡å·ï¼Œä»Šå¤©çš„æ”¶ç›Šå°±ç”¨ä¸Šäº†ã€‚ä½†ç°å®æ˜¯ä½ åªèƒ½<strong>æ˜å¤©å¼€ç›˜</strong>æ‰èƒ½æ‰§è¡Œã€‚å¿…é¡»ç”¨ <code>position.shift(1)</code>ã€‚å¿˜äº†è¿™ä¸€æ­¥ï¼ŒSharpe ä¼šè™šé«˜ 20-50%ã€‚</p>
    </li>
    <li class="trap-item">
      <div class="trap-title">é™·é˜± #4ï¼šå¿½ç•¥ RSI 50 ä¸­çº¿</div>
      <p>RSI 50 æ˜¯å¤šç©ºåˆ†æ°´å²­â€”â€”RSI åœ¨ 50 ä¹‹ä¸Šè¶‹åŠ¿åå¤šï¼Œä¹‹ä¸‹åç©ºã€‚å¾ˆå¤šç­–ç•¥åªçœ‹ 70/30 è€Œå¿½è§† 50ã€‚<strong>å»ºè®®</strong>ï¼šå°† RSI 50 ç”¨ä½œè¶‹åŠ¿è¿‡æ»¤å™¨ï¼šRSI > 50 åªåšå¤šï¼ŒRSI &lt; 50 åªåšç©ºï¼ˆæˆ–ç©ºä»“ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ regime filterã€‚</p>
    </li>
    <li class="trap-item">
      <div class="trap-title">é™·é˜± #5ï¼šæ²¡æœ‰è€ƒè™‘äº¤æ˜“æˆæœ¬</div>
      <p>å‡å€¼å›å½’ç­–ç•¥äº¤æ˜“é¢‘ç¹ï¼ˆæ¯æ¬¡åªæŒä»“å‡ å¤©ï¼‰ã€‚æ¯æ¬¡åŒè¾¹è´¹ç”¨ 0.1% çœ‹èµ·æ¥å¾ˆå°ï¼Œä½†å¦‚æœä¸€å¹´åš 50 æ¬¡ï¼Œå°±æ˜¯ 10% çš„é¢å¤–æˆæœ¬ã€‚åŠ ä¸Šæ»‘ç‚¹ï¼Œé«˜é¢‘å‡å€¼å›å½’ç­–ç•¥åœ¨æ•£æˆ·å±‚é¢å‡ ä¹æ— åˆ©å¯å›¾ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨å›æµ‹ä¸­æ˜¾å¼åŠ å…¥äº¤æ˜“æˆæœ¬ï¼Œçœ‹ Sharpe æ˜¯å¦è¿˜ä¸ºæ­£ã€‚</p>
    </li>
  </ul>
</section>

<!-- Section 8: Full Code -->
<section id="fullcode">
  <h2><span class="icon">ğŸ’»</span> Python å®Œæ•´å›æµ‹ä»£ç </h2>

  <p>æŠŠæ‰€æœ‰çŸ¥è¯†æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§åˆ«çš„å›æµ‹è„šæœ¬ï¼š</p>

<pre><code><span class="st">"""
RSI Mean Reversion Backtest â€” å®Œæ•´ç‰ˆ
Day 9: é‡åŒ–æ—¥æ¨ 2026-02-26

ç­–ç•¥ï¼šRSI è¶…å–/è¶…ä¹° + EMA200 è¶‹åŠ¿è¿‡æ»¤ + å›å‰ç¡®è®¤å…¥åœº
æ ‡çš„ï¼šSPY (2020-2025)
"""</span>

<span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> yfinance <span class="kw">as</span> yf
<span class="kw">import</span> matplotlib.pyplot <span class="kw">as</span> plt
<span class="kw">import</span> warnings
warnings.filterwarnings(<span class="st">'ignore'</span>)

<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. æ•°æ®è·å–
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
TICKER = <span class="st">"SPY"</span>
START  = <span class="st">"2020-01-01"</span>
END    = <span class="st">"2025-01-01"</span>

df = yf.download(TICKER, start=START, end=END, progress=<span class="nm">False</span>)
close = df[<span class="st">'Close'</span>].squeeze()
<span class="fn">print</span>(<span class="st">f"æ•°æ®: {START} to {END}, {len(close)} ä¸ªäº¤æ˜“æ—¥"</span>)


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. æŒ‡æ ‡è®¡ç®—
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="kw">def</span> <span class="fn">calc_rsi</span>(s, n=<span class="nm">14</span>):
    d = s.diff()
    g = d.clip(lower=<span class="nm">0</span>).ewm(alpha=<span class="nm">1</span>/n, adjust=<span class="nm">False</span>).mean()
    l = (-d).clip(lower=<span class="nm">0</span>).ewm(alpha=<span class="nm">1</span>/n, adjust=<span class="nm">False</span>).mean()
    rs = g / l
    <span class="kw">return</span> (<span class="nm">100</span> - <span class="nm">100</span>/(<span class="nm">1</span>+rs)).where(l!=<span class="nm">0</span>, <span class="nm">100</span>)

rsi    = <span class="fn">calc_rsi</span>(close, n=<span class="nm">14</span>)
ema200 = close.ewm(span=<span class="nm">200</span>, adjust=<span class="nm">False</span>).mean()
ema50  = close.ewm(span=<span class="nm">50</span>,  adjust=<span class="nm">False</span>).mean()


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. ä¿¡å·ç”Ÿæˆ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
prev_rsi = rsi.shift(<span class="nm">1</span>)
uptrend  = close > ema200

<span class="cm"># RSI å›å‰ä¿¡å·</span>
long_cross  = (prev_rsi < <span class="nm">30</span>) & (rsi >= <span class="nm">30</span>)   <span class="cm"># ä»è¶…å–åŒºä¸Šç©¿ 30</span>
short_cross = (prev_rsi > <span class="nm">70</span>) & (rsi <= <span class="nm">70</span>)   <span class="cm"># ä»è¶…ä¹°åŒºä¸‹ç©¿ 70</span>

<span class="cm"># åŠ å…¥ EMA200 è¶‹åŠ¿è¿‡æ»¤</span>
long_signal  = long_cross  & uptrend
short_signal = short_cross & ~uptrend


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 4. æŒä»“é€»è¾‘
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
position = pd.Series(<span class="nm">0</span>, index=close.index, dtype=float)
pos = <span class="nm">0</span>

<span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="nm">1</span>, <span class="fn">len</span>(close)):
    <span class="cm"># æ–°ä¿¡å·è¦†ç›–æ—§æŒä»“</span>
    <span class="kw">if</span>   long_signal.iloc[i]:                        pos = <span class="nm">1</span>
    <span class="kw">elif</span> short_signal.iloc[i]:                       pos = -<span class="nm">1</span>
    <span class="cm"># é€€å‡ºæ¡ä»¶ï¼šRSI ç©¿è¶Š 50 ä¸­çº¿</span>
    <span class="kw">elif</span> pos ==  <span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] > <span class="nm">50</span>:           pos = <span class="nm">0</span>
    <span class="kw">elif</span> pos == -<span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] < <span class="nm">50</span>:           pos = <span class="nm">0</span>
    <span class="cm"># è¶…å‡ºå®¹å¿ï¼šRSI å†ç ´æç«¯ï¼ˆæ­¢æŸï¼‰</span>
    <span class="kw">elif</span> pos ==  <span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] < <span class="nm">20</span>:           pos = <span class="nm">0</span>
    <span class="kw">elif</span> pos == -<span class="nm">1</span> <span class="kw">and</span> rsi.iloc[i] > <span class="nm">80</span>:           pos = <span class="nm">0</span>
    position.iloc[i] = pos


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 5. æ”¶ç›Šè®¡ç®—ï¼ˆåŠ å…¥äº¤æ˜“æˆæœ¬ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
COST_PER_TRADE = <span class="nm">0.001</span>  <span class="cm"># 0.1% å•è¾¹ï¼Œå³åŒè¾¹ 0.2%</span>
daily_ret = close.pct_change()

<span class="cm"># âš ï¸ å…³é”®ï¼šä¿¡å·åœ¨ä»Šå¤©æ”¶ç›˜äº§ç”Ÿï¼Œæ˜å¤©æ‰èƒ½æ‰§è¡Œï¼ˆshift(1)ï¼‰</span>
strategy_ret = position.shift(<span class="nm">1</span>) * daily_ret

<span class="cm"># è®¡ç®—æ¢æ‰‹æ¬¡æ•°ï¼Œæ‰£é™¤äº¤æ˜“æˆæœ¬</span>
trades = position.diff().abs() / <span class="nm">2</span>  <span class="cm"># æ¯æ¬¡æ¢ä»“è®¡ä¸º 1 æ¬¡äº¤æ˜“</span>
strategy_ret -= trades * COST_PER_TRADE

<span class="cm"># Buy & Hold åŸºå‡†</span>
bh_ret = daily_ret


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 6. ç»©æ•ˆç»Ÿè®¡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="kw">def</span> <span class="fn">calc_stats</span>(returns, label=<span class="st">"Strategy"</span>):
    cum   = (<span class="nm">1</span> + returns).cumprod()
    peak  = cum.expanding().max()
    dd    = (cum / peak - <span class="nm">1</span>)
    
    <span class="cm"># Sharpe (å¹´åŒ–ï¼Œæ— é£é™©åˆ©ç‡ 5%)</span>
    excess = returns - <span class="nm">0.05</span>/<span class="nm">252</span>
    sharpe = excess.mean() / excess.std() * np.sqrt(<span class="nm">252</span>)
    
    <span class="cm"># Calmar Ratio = å¹´åŒ–æ”¶ç›Š / æœ€å¤§å›æ’¤ç»å¯¹å€¼</span>
    ann_ret = (<span class="nm">1</span> + returns.mean())**<span class="nm">252</span> - <span class="nm">1</span>
    calmar  = ann_ret / abs(dd.min()) <span class="kw">if</span> dd.min() != <span class="nm">0</span> <span class="kw">else</span> np.nan
    
    <span class="fn">print</span>(<span class="st">f"\n{'='*40}"</span>)
    <span class="fn">print</span>(<span class="st">f"  {label}"</span>)
    <span class="fn">print</span>(<span class="st">f"{'='*40}"</span>)
    <span class="fn">print</span>(<span class="st">f"  æ€»æ”¶ç›Šç‡:    {(cum.iloc[-1]-1)*100:.2f}%"</span>)
    <span class="fn">print</span>(<span class="st">f"  å¹´åŒ–æ”¶ç›Š:    {ann_ret*100:.2f}%"</span>)
    <span class="fn">print</span>(<span class="st">f"  Sharpeæ¯”:    {sharpe:.3f}"</span>)
    <span class="fn">print</span>(<span class="st">f"  æœ€å¤§å›æ’¤:    {dd.min()*100:.2f}%"</span>)
    <span class="fn">print</span>(<span class="st">f"  Calmar:      {calmar:.3f}"</span>)
    <span class="fn">print</span>(<span class="st">f"  èƒœç‡:        {(returns>0).mean()*100:.1f}%"</span>)
    <span class="kw">return</span> cum

cum_strategy = <span class="fn">calc_stats</span>(strategy_ret, <span class="st">"RSI + EMA200 ç­–ç•¥"</span>)
cum_bh       = <span class="fn">calc_stats</span>(bh_ret,       <span class="st">"Buy & Hold SPY"</span>)


<span class="cm"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 7. å¯è§†åŒ–ï¼ˆæƒç›Šæ›²çº¿ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
fig, axes = plt.subplots(<span class="nm">3</span>, <span class="nm">1</span>, figsize=(<span class="nm">14</span>, <span class="nm">10</span>), sharex=<span class="nm">True</span>)
fig.patch.set_facecolor(<span class="st">'#0d1117'</span>)
<span class="kw">for</span> ax <span class="kw">in</span> axes:
    ax.set_facecolor(<span class="st">'#161b22'</span>)
    ax.tick_params(colors=<span class="st">'#8b949e'</span>)
    <span class="kw">for</span> spine <span class="kw">in</span> ax.spines.values():
        spine.set_color(<span class="st">'#30363d'</span>)

<span class="cm"># å›¾1: ä»·æ ¼ + EMA</span>
axes[<span class="nm">0</span>].plot(close, color=<span class="st">'#e6edf3'</span>, lw=<span class="nm">1</span>, label=<span class="st">'SPY'</span>)
axes[<span class="nm">0</span>].plot(ema50,  color=<span class="st">'#58a6ff'</span>, lw=<span class="nm">1</span>, alpha=<span class="nm">0.8</span>, label=<span class="st">'EMA50'</span>)
axes[<span class="nm">0</span>].plot(ema200, color=<span class="st">'#ffa657'</span>, lw=<span class="nm">1.5</span>, alpha=<span class="nm">0.9</span>, label=<span class="st">'EMA200'</span>)
axes[<span class="nm">0</span>].set_title(<span class="st">'SPY Price + EMA'</span>, color=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">11</span>)
axes[<span class="nm">0</span>].legend(facecolor=<span class="st">'#21262d'</span>, labelcolor=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">8</span>)

<span class="cm"># å›¾2: RSI</span>
axes[<span class="nm">1</span>].plot(rsi, color=<span class="st">'#d2a8ff'</span>, lw=<span class="nm">1</span>)
axes[<span class="nm">1</span>].axhline(<span class="nm">70</span>, color=<span class="st">'#f85149'</span>, ls=<span class="st">'--'</span>, lw=<span class="nm">0.8</span>, alpha=<span class="nm">0.7</span>, label=<span class="st">'Overbought (70)'</span>)
axes[<span class="nm">1</span>].axhline(<span class="nm">30</span>, color=<span class="st">'#3fb950'</span>, ls=<span class="st">'--'</span>, lw=<span class="nm">0.8</span>, alpha=<span class="nm">0.7</span>, label=<span class="st">'Oversold (30)'</span>)
axes[<span class="nm">1</span>].axhline(<span class="nm">50</span>, color=<span class="st">'#8b949e'</span>, ls=<span class="st">':'</span>,  lw=<span class="nm">0.6</span>, alpha=<span class="nm">0.5</span>, label=<span class="st">'Centerline (50)'</span>)
axes[<span class="nm">1</span>].fill_between(rsi.index, rsi, <span class="nm">30</span>, where=(rsi<<span class="nm">30</span>), alpha=<span class="nm">0.3</span>, color=<span class="st">'#3fb950'</span>)
axes[<span class="nm">1</span>].fill_between(rsi.index, rsi, <span class="nm">70</span>, where=(rsi><span class="nm">70</span>), alpha=<span class="nm">0.3</span>, color=<span class="st">'#f85149'</span>)
axes[<span class="nm">1</span>].set_ylim(<span class="nm">0</span>, <span class="nm">100</span>)
axes[<span class="nm">1</span>].set_title(<span class="st">'RSI (14)'</span>, color=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">11</span>)
axes[<span class="nm">1</span>].legend(facecolor=<span class="st">'#21262d'</span>, labelcolor=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">8</span>)

<span class="cm"># å›¾3: æƒç›Šæ›²çº¿å¯¹æ¯”</span>
axes[<span class="nm">2</span>].plot(cum_strategy, color=<span class="st">'#58a6ff'</span>, lw=<span class="nm">1.5</span>, label=<span class="st">'RSI + EMA200 Strategy'</span>)
axes[<span class="nm">2</span>].plot(cum_bh,       color=<span class="st">'#ffa657'</span>, lw=<span class="nm">1.5</span>, label=<span class="st">'Buy & Hold'</span>)
axes[<span class="nm">2</span>].axhline(<span class="nm">1</span>, color=<span class="st">'#8b949e'</span>, ls=<span class="st">'--'</span>, lw=<span class="nm">0.5</span>)
axes[<span class="nm">2</span>].set_title(<span class="st">'Equity Curve Comparison'</span>, color=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">11</span>)
axes[<span class="nm">2</span>].legend(facecolor=<span class="st">'#21262d'</span>, labelcolor=<span class="st">'#e6edf3'</span>, fontsize=<span class="nm">8</span>)

plt.tight_layout()
plt.savefig(<span class="st">'rsi_backtest_equity_curve.png'</span>, dpi=<span class="nm">150</span>, bbox_inches=<span class="st">'tight'</span>)
plt.show()
<span class="fn">print</span>(<span class="st">"\nâœ… æƒç›Šæ›²çº¿å·²ä¿å­˜è‡³ rsi_backtest_equity_curve.png"</span>)</code></pre>

  <div class="alert success">
    <strong>âœ… é¢„æœŸç»“æœï¼ˆå‚è€ƒèŒƒå›´ï¼‰</strong>
    RSI + EMA200 ç­–ç•¥åœ¨ SPY 2020-2025 ä¸Šçš„ Sharpe çº¦ 0.5-0.8ï¼ˆå«æˆæœ¬ï¼‰ã€‚æ³¨æ„è¿™ä¸ªç­–ç•¥åœ¨ 2020 å¹´æ–°å† æš´è·ŒæœŸé—´å¯èƒ½æœ‰å¤šæ¬¡è¶…å–ä¿¡å·ï¼Œéƒ¨åˆ†èƒ½æ•æ‰åˆ°åå¼¹ã€‚åœ¨ 2022 å¹´ç†Šå¸‚æœŸé—´ï¼ŒEMA200 è¿‡æ»¤å™¨ä¼šå±è”½å¤§å¤šæ•°åšå¤šä¿¡å·ï¼Œé¿å…è¿½è·Œã€‚è¿™ä½“ç°äº† RSI + è¶‹åŠ¿è¿‡æ»¤ çš„ç»„åˆä»·å€¼ã€‚
  </div>
</section>

<!-- Thought Question -->
<div class="thought-q">
  <div class="q-label">ğŸ’­ ä»Šæ—¥æ€è€ƒé¢˜</div>
  <h3>RSI è¶…å–ï¼ˆ&lt; 30ï¼‰æ˜¯"æŠ„åº•æœºä¼š"ï¼Œè¿˜æ˜¯"æ¥åˆ€å­"ï¼Ÿ<br>ä½ ä¼šå¦‚ä½•ç”¨æ•°æ®æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼Ÿ</h3>
  <p style="color:var(--muted);font-size:0.88rem;margin-top:1rem;">æç¤ºï¼šç»Ÿè®¡ SPY å†å²ä¸Š RSI é¦–æ¬¡è§¦å‘ &lt; 30 åï¼Œæ¥ä¸‹æ¥ 1/5/10/20 æ—¥çš„å¹³å‡æ”¶ç›Šå’Œèƒœç‡ã€‚è¿™ä¸ªç»Ÿè®¡ç»“æœä¼šæ”¹å˜ä½ å¯¹è¶…å–ä¿¡å·çš„çœ‹æ³•å—ï¼Ÿ</p>
</div>

<!-- Key Takeaways -->
<section style="margin-top:2.5rem;">
  <h2><span class="icon">ğŸ¯</span> æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h2>
  <div class="card-grid">
    <div class="card blue">
      <h4>1. RSI æ•°å­¦</h4>
      <p>ç”¨ Wilder's SMMAï¼ˆewm alpha=1/Nï¼‰å®ç°ï¼Œä¸æ˜¯ç®€å•å¹³å‡ã€‚ç¬¬ä¸€ä¸ªå€¼è¦ç”¨ SMA åˆå§‹åŒ–ã€‚</p>
    </div>
    <div class="card yellow">
      <h4>2. 70/30 æ˜¯ç»éªŒå€¼</h4>
      <p>åœ¨è¶‹åŠ¿å¸‚åœºä¸­å¤±æ•ˆã€‚å¼ºåŠ¿è‚¡ RSI å¯ä»¥åœ¨ 70+ ç»´æŒæ•°æœˆã€‚éœ€è¦æ ¹æ®å¸‚åœº regime è°ƒæ•´é˜ˆå€¼ã€‚</p>
    </div>
    <div class="card green">
      <h4>3. ç­‰å›å‰å…¥åœº</h4>
      <p>ä¸è¦åœ¨è§¦ç¢° 30/70 æ—¶ç«‹åˆ»å…¥åœºã€‚ç­‰ RSI å›å‰é˜ˆå€¼æ‰ç¡®è®¤ï¼Œé™ä½æ¥åˆ€é£é™©ã€‚</p>
    </div>
    <div class="card purple">
      <h4>4. èƒŒç¦»æ›´å¯é </h4>
      <p>ä»·æ ¼æ–°ä½ + RSI é«˜ä½ = çœ‹æ¶¨èƒŒç¦»ï¼ŒåŠ¨èƒ½è¡°å‡ã€‚æ¯”ç»å¯¹å€¼ä¿¡å·æ›´æœ‰é¢„æµ‹åŠ›ï¼Œä½†éœ€æ³¨æ„ look-ahead biasã€‚</p>
    </div>
    <div class="card blue">
      <h4>5. RSI + EMA200</h4>
      <p>åœ¨ EMA200 ä¸Šæ–¹æ‰åšå¤šå‡å€¼å›å½’ã€‚è¶‹åŠ¿è¿‡æ»¤å¤§å¹…å‡å°‘ç†Šå¸‚å‡ä¿¡å·ï¼Œæå‡ Sharpeã€‚</p>
    </div>
    <div class="card red">
      <h4>6. äº”å¤§é™·é˜±</h4>
      <p>è¿‡æ‹Ÿåˆé˜ˆå€¼ Â· look-ahead bias Â· å¿˜è®° shift(1) Â· å¿½è§† RSI50 Â· ä¸è®¡äº¤æ˜“æˆæœ¬ã€‚</p>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="footer">
  <div>
    <div>ğŸ“š é‡åŒ–æ—¥æ¨ â€” Day 9 of âˆ</div>
    <div style="margin-top:0.3rem;">Phase 2: Technical Indicators | 2026-02-26</div>
  </div>
  <div class="next-prev">
    <a class="nav-link" href="2026-02-23-moving-averages.html">â† Day 8: ç§»åŠ¨å¹³å‡çº¿</a>
    <a class="nav-link" href="#">Day 10: MACD â†’</a>
  </div>
</footer>

</body>
</html>
