<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>2026-02-27 - Few-shot vs Zero-shot Prompting æœ€ä½³å®è·µ</title>
  <style>
    body { font-family: -apple-system, system-ui, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; line-height: 1.7; color: #333; }
    .bilingual { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .zh { border-left: 3px solid #f9ab00; padding-left: 15px; }
    .en { border-left: 3px solid #1a73e8; padding-left: 15px; }
    h1 { color: #3c4043; }
    h2 { color: #1a73e8; border-bottom: 2px solid #e8eaed; padding-bottom: 8px; }
    .architecture { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; }
    pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px; }
    code { font-family: 'SF Mono', Monaco, monospace; }
    .highlight { background: #fff3cd; padding: 12px 15px; border-radius: 8px; margin: 10px 0; }
    .highlight-blue { background: #d1ecf1; padding: 12px 15px; border-radius: 8px; margin: 10px 0; }
    .highlight-green { background: #d4edda; padding: 12px 15px; border-radius: 8px; margin: 10px 0; }
    .highlight-red { background: #f8d7da; padding: 12px 15px; border-radius: 8px; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; }
    th, td { border: 1px solid #dadce0; padding: 10px 12px; text-align: left; }
    th { background: #f8f9fa; font-weight: 600; }
    .diagram { background: #f0f4f8; padding: 20px; border-radius: 8px; margin: 20px 0; font-family: monospace; white-space: pre; font-size: 13px; line-height: 1.5; }
    .interview { background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #4caf50; }
    .pattern { background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9c27b0; }
    .follow-up { margin-top: 30px; padding: 15px; border: 1px dashed #dadce0; border-radius: 8px; }
    @media (max-width: 768px) { .bilingual { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>ğŸ¯ Few-shot vs Zero-shot Prompting æœ€ä½³å®è·µ</h1>
  <p>ğŸ“… 2026-02-27 | Prompt Engineering ç³»åˆ— Day 2 | æ‰¿æ¥ Day 1 Chain-of-Thought</p>

  <h2>ğŸ“– æ ¸å¿ƒé—®é¢˜ / The Core Question</h2>
  <div class="bilingual">
    <div class="zh">
      <p>ä»€ä¹ˆæ—¶å€™ç»™æ¨¡å‹ç¤ºä¾‹ï¼Ÿç»™å‡ ä¸ªï¼Ÿæ€ä¹ˆé€‰ï¼Ÿ</p>
      <p>è¿™çœ‹ä¼¼ç®€å•çš„é—®é¢˜ï¼Œå®é™…ä¸Šå†³å®šäº†ä½ çš„ LLM åº”ç”¨çš„<strong>è´¨é‡ä¸Šé™</strong>ã€‚Day 1 è®²äº†ã€Œæ€ä¹ˆè®©æ¨¡å‹æ€è€ƒã€(CoT)ï¼Œä»Šå¤©è®²ã€Œæ€ä¹ˆé€šè¿‡ç¤ºä¾‹æ•™æ¨¡å‹åšäº‹ã€ã€‚</p>
      <p>æ ¸å¿ƒæ´å¯Ÿï¼š<strong>ç¤ºä¾‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè€Œæ˜¯è¶Šå¯¹è¶Šå¥½ã€‚</strong></p>
    </div>
    <div class="en">
      <p>When should you give the model examples? How many? How to select them?</p>
      <p>This seemingly simple question determines the <strong>quality ceiling</strong> of your LLM app. Day 1 covered "how to make models think" (CoT); today is about "how to teach models by example."</p>
      <p>Key insight: <strong>More examples â‰  better. The right examples = better.</strong></p>
    </div>
  </div>

  <h2>ğŸ—ï¸ å››ç§ Prompting æ¨¡å¼å¯¹æ¯” / The Four Modes</h2>

  <table>
    <tr>
      <th>æ¨¡å¼</th>
      <th>ç¤ºä¾‹æ•°</th>
      <th>é€‚ç”¨åœºæ™¯</th>
      <th>Token æˆæœ¬</th>
      <th>è´¨é‡</th>
    </tr>
    <tr>
      <td><strong>Zero-shot</strong></td>
      <td>0</td>
      <td>æ¨¡å‹å·²æœ‰èƒ½åŠ›ã€ç®€å•ä»»åŠ¡</td>
      <td>æœ€ä½ â­</td>
      <td>å–å†³äºä»»åŠ¡</td>
    </tr>
    <tr>
      <td><strong>One-shot</strong></td>
      <td>1</td>
      <td>æ ¼å¼å¯¹é½ã€å¿«é€ŸåŸå‹</td>
      <td>ä½ â­â­</td>
      <td>æ¯” Zero å¥½å¾ˆå¤š</td>
    </tr>
    <tr>
      <td><strong>Few-shot</strong></td>
      <td>3-8</td>
      <td>å¤æ‚åˆ†ç±»ã€ç‰¹å®šæ ¼å¼ã€è¾¹ç•Œæƒ…å†µ</td>
      <td>ä¸­ â­â­â­</td>
      <td>é€šå¸¸æœ€ä¼˜</td>
    </tr>
    <tr>
      <td><strong>Many-shot</strong></td>
      <td>10-100+</td>
      <td>é•¿ context æ¨¡å‹ã€é«˜ç²¾åº¦éœ€æ±‚</td>
      <td>é«˜ â­â­â­â­</td>
      <td>è¾¹é™…é€’å‡</td>
    </tr>
  </table>

  <div class="highlight">
    <strong>ğŸ’¡ ç»éªŒæ³•åˆ™ (Rule of Thumb)</strong>ï¼šä» zero-shot å¼€å§‹ï¼Œå¦‚æœæ•ˆæœä¸æ»¡æ„ï¼ŒåŠ  1-3 ä¸ªç¤ºä¾‹é€šå¸¸å°±å¤Ÿã€‚åªæœ‰åœ¨åˆ†ç±»/æ ¼å¼åŒ–/è¾¹ç•Œcase æ˜ç¡®æ—¶æ‰éœ€è¦ 5+ ä¸ªç¤ºä¾‹ã€‚
  </div>

  <h2>ğŸ”¬ Zero-shot: ä»€ä¹ˆæ—¶å€™å¤Ÿç”¨ï¼Ÿ/ When Is It Enough?</h2>

  <div class="bilingual">
    <div class="zh">
      <p>ç°ä»£å¤§æ¨¡å‹ (Claude 3.5+, GPT-4+) çš„ zero-shot èƒ½åŠ›å·²ç»<strong>éå¸¸å¼º</strong>ã€‚ä»¥ä¸‹åœºæ™¯é€šå¸¸ zero-shot å°±å¤Ÿäº†ï¼š</p>
      <ul>
        <li>âœ… <strong>é€šç”¨ NLP ä»»åŠ¡</strong>ï¼šç¿»è¯‘ã€æ‘˜è¦ã€æ”¹å†™</li>
        <li>âœ… <strong>ä»£ç ç”Ÿæˆ</strong>ï¼šæ ‡å‡†ç®—æ³•ã€å¸¸è§æ¡†æ¶</li>
        <li>âœ… <strong>å¼€æ”¾å¼é—®ç­”</strong>ï¼šè§£é‡Šæ¦‚å¿µã€åˆ†æ</li>
        <li>âœ… <strong>ç®€å•åˆ†ç±»</strong>ï¼šæƒ…æ„Ÿåˆ†æ (positive/negative)</li>
      </ul>
      <p><strong>å…³é”®æŠ€å·§</strong>ï¼šZero-shot ä¸ç­‰äºã€Œåªç»™ä¸€å¥è¯ã€ã€‚å¥½çš„ zero-shot prompt åŒ…å«ï¼š</p>
    </div>
    <div class="en">
      <p>Modern LLMs (Claude 3.5+, GPT-4+) have <strong>remarkably strong</strong> zero-shot capabilities. These scenarios usually work fine zero-shot:</p>
      <ul>
        <li>âœ… <strong>General NLP</strong>: translation, summarization, rewriting</li>
        <li>âœ… <strong>Code generation</strong>: standard algorithms, common frameworks</li>
        <li>âœ… <strong>Open-ended Q&A</strong>: explaining concepts, analysis</li>
        <li>âœ… <strong>Simple classification</strong>: sentiment (positive/negative)</li>
      </ul>
      <p><strong>Key trick</strong>: Zero-shot â‰  "just one sentence." A good zero-shot prompt includes:</p>
    </div>
  </div>

  <pre><code>// âœ… å¥½çš„ Zero-shot Prompt ç»“æ„
const zeroShotPrompt = `
You are an expert code reviewer for TypeScript projects.

## Task
Review the following code for:
1. Security vulnerabilities
2. Performance issues  
3. Code style violations

## Output Format
Return a JSON array of issues:
[{ "line": number, "severity": "high"|"medium"|"low", "message": string }]

## Rules
- Only flag real issues, not style preferences
- Include the specific line number
- Explain WHY it's an issue, not just WHAT

## Code
\`\`\`typescript
${code}
\`\`\`
`;
</code></pre>

  <div class="highlight-blue">
    <strong>ğŸ¯ Zero-shot çš„ç§˜å¯†æ­¦å™¨</strong>ï¼š
    <ul>
      <li><strong>è§’è‰²è®¾å®š</strong> (role) â€” æ¿€æ´»æ¨¡å‹ç‰¹å®šçŸ¥è¯†</li>
      <li><strong>è¾“å‡ºæ ¼å¼</strong> (format) â€” çº¦æŸè¾“å‡ºç»“æ„</li>
      <li><strong>è§„åˆ™çº¦æŸ</strong> (rules) â€” æ˜ç¡®è¾¹ç•Œæ¡ä»¶</li>
      <li><strong>è´Ÿé¢æŒ‡ä»¤</strong> (what NOT to do) â€” é˜²æ­¢å¸¸è§é”™è¯¯</li>
    </ul>
    å³ä½¿ä¸ç»™ç¤ºä¾‹ï¼Œè¿™å››è¦ç´ ä¹Ÿèƒ½è®© zero-shot æ•ˆæœæ¥è¿‘ few-shotï¼
  </div>

  <h2>ğŸ¯ Few-shot: ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ï¼Ÿ/ When Must You Use It?</h2>

  <div class="bilingual">
    <div class="zh">
      <h4>åœºæ™¯ 1: éæ ‡å‡†è¾“å‡ºæ ¼å¼</h4>
      <p>å½“ä½ éœ€è¦æ¨¡å‹è¾“å‡º<strong>ä½ è‡ªå®šä¹‰çš„æ ¼å¼</strong>æ—¶ï¼Œä¸€ä¸ªç¤ºä¾‹é¡¶åƒè¨€ã€‚</p>
      
      <h4>åœºæ™¯ 2: é¢†åŸŸç‰¹å®šåˆ†ç±»</h4>
      <p>å½“åˆ†ç±»æ ‡å‡†ä¸æ˜¯ã€Œå¸¸è¯†ã€ï¼Œè€Œæ˜¯<strong>ä½ çš„ä¸šåŠ¡é€»è¾‘</strong>æ—¶ã€‚</p>
      
      <h4>åœºæ™¯ 3: è¾¹ç•Œæƒ…å†µå¤„ç†</h4>
      <p>å‘Šè¯‰æ¨¡å‹ã€Œè¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆåšã€æ¯”æè¿°è§„åˆ™æ›´ç›´æ¥ã€‚</p>
      
      <h4>åœºæ™¯ 4: è¯­æ°”/é£æ ¼å¯¹é½</h4>
      <p>è®©æ¨¡å‹æ¨¡ä»¿ç‰¹å®šå†™ä½œé£æ ¼ï¼Œç¤ºä¾‹æ¯”æè¿°æ›´æœ‰æ•ˆã€‚</p>
    </div>
    <div class="en">
      <h4>Scenario 1: Non-standard output format</h4>
      <p>When you need <strong>your custom format</strong>, one example beats a thousand words.</p>
      
      <h4>Scenario 2: Domain-specific classification</h4>
      <p>When labels follow <strong>your business logic</strong>, not common sense.</p>
      
      <h4>Scenario 3: Edge case handling</h4>
      <p>Showing "what to do here" is more direct than describing rules.</p>
      
      <h4>Scenario 4: Tone/style alignment</h4>
      <p>Examples communicate style more effectively than descriptions.</p>
    </div>
  </div>

  <pre><code>// Few-shot å®æˆ˜: å®¢æœå·¥å•åˆ†ç±»
// è¿™ä¸ªåˆ†ç±»æ ‡å‡†æ˜¯ã€Œä½ çš„ä¸šåŠ¡é€»è¾‘ã€ï¼Œæ¨¡å‹æ²¡æœ‰å…ˆéªŒçŸ¥è¯†

const fewShotPrompt = `
Classify support tickets into: billing, technical, account, feature-request.

Examples:
---
Ticket: "I was charged twice for my subscription last month"
Category: billing
Reasoning: Duplicate charge is a payment/billing issue
---
Ticket: "The API returns 500 when I upload files larger than 10MB"
Category: technical
Reasoning: API error with specific reproduction steps = technical bug
---
Ticket: "Can you add dark mode to the dashboard?"
Category: feature-request
Reasoning: User requesting new functionality
---
Ticket: "I can't log in, it says my email isn't registered but I've been using it for months"
Category: account
Reasoning: Login/authentication issue related to account state
---
Now classify this ticket:
Ticket: "${userTicket}"
Category:`;
</code></pre>

  <h2>âš¡ äº”å¤§ Few-shot æœ€ä½³å®è·µ / Five Best Practices</h2>

  <div class="pattern">
    <h4>Pattern 1: ç¤ºä¾‹å¤šæ ·æ€§ > ç¤ºä¾‹æ•°é‡ (Diversity Over Quantity)</h4>
    <div class="bilingual">
      <div class="zh">
        <p>è¦†ç›–æ¯ä¸ªç±»åˆ«è‡³å°‘ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¯”ä¸€ä¸ªç±»åˆ«ç»™5ä¸ªç¤ºä¾‹æ›´æœ‰æ•ˆã€‚</p>
        <p><strong>âŒ é”™è¯¯</strong>ï¼š5ä¸ª positive æƒ…æ„Ÿç¤ºä¾‹ + 0ä¸ª negative</p>
        <p><strong>âœ… æ­£ç¡®</strong>ï¼š1ä¸ª positive + 1ä¸ª negative + 1ä¸ª neutral + 1ä¸ªè¾¹ç•Œcase</p>
      </div>
      <div class="en">
        <p>Covering each category once beats giving 5 examples of one category.</p>
        <p><strong>âŒ Wrong</strong>: 5 positive sentiment examples + 0 negative</p>
        <p><strong>âœ… Right</strong>: 1 positive + 1 negative + 1 neutral + 1 edge case</p>
      </div>
    </div>
  </div>

  <div class="pattern">
    <h4>Pattern 2: åŒ…å«è¾¹ç•Œ Case (Include Edge Cases)</h4>
    <div class="bilingual">
      <div class="zh">
        <p>æœ€æœ‰ä»·å€¼çš„ç¤ºä¾‹ä¸æ˜¯ã€Œå…¸å‹ã€caseï¼Œè€Œæ˜¯ã€Œæ¨¡å‹å®¹æ˜“æé”™ã€çš„ caseã€‚</p>
        <p>æ¯”å¦‚åˆ†ç±»ä¸­æ¨¡æ£±ä¸¤å¯çš„ä¾‹å­ã€è¾“å‡ºä¸­éœ€è¦ç‰¹æ®Šå¤„ç†çš„æƒ…å†µã€‚</p>
      </div>
      <div class="en">
        <p>The most valuable examples aren't "typical" cases â€” they're cases the <strong>model would likely get wrong</strong>.</p>
        <p>E.g., ambiguous classifications, outputs needing special handling.</p>
      </div>
    </div>
  </div>

  <div class="pattern">
    <h4>Pattern 3: ç¤ºä¾‹é¡ºåºå¾ˆé‡è¦ (Order Matters)</h4>
    <div class="bilingual">
      <div class="zh">
        <p>ç ”ç©¶è¡¨æ˜ï¼Œfew-shot ç¤ºä¾‹çš„é¡ºåºä¼šå½±å“ç»“æœï¼š</p>
        <ul>
          <li>æŠŠæœ€ç›¸ä¼¼çš„ç¤ºä¾‹æ”¾åœ¨<strong>æœ€å</strong>ï¼ˆç¦» query æœ€è¿‘ = å½±å“æœ€å¤§ï¼‰</li>
          <li>éšæœºæ‰“ä¹±é¡ºåºå¯ä»¥å‡å°‘ recency bias</li>
          <li>å¯¹äºåˆ†ç±»ä»»åŠ¡ï¼Œå¹³è¡¡å„ç±»åˆ«çš„ä½ç½®</li>
        </ul>
      </div>
      <div class="en">
        <p>Research shows example order affects results:</p>
        <ul>
          <li>Place the most similar example <strong>last</strong> (closest to query = most influence)</li>
          <li>Random shuffling reduces recency bias</li>
          <li>For classification, balance category positions</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="pattern">
    <h4>Pattern 4: åŠ å…¥æ¨ç†è¿‡ç¨‹ (Include Reasoning / CoT + Few-shot)</h4>
    <div class="bilingual">
      <div class="zh">
        <p>Day 1 çš„ CoT ä¸ Few-shot ç»“åˆ = <strong>å¨åŠ›å€å¢</strong>ã€‚</p>
        <p>ä¸ä»…å±•ç¤ºã€Œä»€ä¹ˆæ˜¯æ­£ç¡®ç­”æ¡ˆã€ï¼Œè¿˜å±•ç¤ºã€Œæ€ä¹ˆå¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€ã€‚</p>
      </div>
      <div class="en">
        <p>Combining Day 1's CoT with Few-shot = <strong>multiplied effectiveness</strong>.</p>
        <p>Show not just "what the right answer is" but "how to get there."</p>
      </div>
    </div>
  </div>

  <div class="pattern">
    <h4>Pattern 5: åŠ¨æ€ç¤ºä¾‹é€‰æ‹© (Dynamic Example Selection)</h4>
    <div class="bilingual">
      <div class="zh">
        <p>é™æ€ few-shot å¯¹æ‰€æœ‰è¾“å…¥ç”¨ç›¸åŒç¤ºä¾‹ã€‚<strong>åŠ¨æ€é€‰æ‹©</strong>æ ¹æ®ç”¨æˆ·è¾“å…¥é€‰æœ€ç›¸å…³çš„ç¤ºä¾‹ã€‚</p>
        <p>è¿™æ˜¯ä»ã€Œä¸šä½™ã€åˆ°ã€Œç”Ÿäº§çº§ã€çš„å…³é”®è·¨è¶Šã€‚</p>
      </div>
      <div class="en">
        <p>Static few-shot uses the same examples for all inputs. <strong>Dynamic selection</strong> picks the most relevant examples per input.</p>
        <p>This is the key leap from "amateur" to "production-grade."</p>
      </div>
    </div>
  </div>

  <h2>ğŸ”¥ ç”Ÿäº§çº§: åŠ¨æ€ Few-shot é€‰æ‹© / Dynamic Few-shot Selection</h2>

  <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Dynamic Few-shot Pipeline              â”‚
â”‚                                                   â”‚
â”‚  User Query â”€â”€â†’ Embed(query)                     â”‚
â”‚                      â”‚                            â”‚
â”‚                      â–¼                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚           â”‚  Example Store   â”‚                    â”‚
â”‚           â”‚  (Vector DB)     â”‚                    â”‚
â”‚           â”‚                  â”‚                    â”‚
â”‚           â”‚  [embâ‚] exâ‚     â”‚                    â”‚
â”‚           â”‚  [embâ‚‚] exâ‚‚     â”‚   kNN Search       â”‚
â”‚           â”‚  [embâ‚ƒ] exâ‚ƒ     â”‚â—„â”€â”€â”€â”€ top-k         â”‚
â”‚           â”‚  ...             â”‚                    â”‚
â”‚           â”‚  [embâ‚™] exâ‚™     â”‚                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â”‚                              â”‚
â”‚                    â–¼                              â”‚
â”‚           Select top-k examples                  â”‚
â”‚           + Diversity filter                     â”‚
â”‚           + Category balance                     â”‚
â”‚                    â”‚                              â”‚
â”‚                    â–¼                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  System Prompt                  â”‚             â”‚
â”‚   â”‚  + Selected Examples (3-5)      â”‚             â”‚
â”‚   â”‚  + User Query                   â”‚   â”€â”€â†’ LLM  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>

  <pre><code>// ç”Ÿäº§çº§åŠ¨æ€ Few-shot é€‰æ‹©å™¨ (TypeScript)
import { embed } from './embeddings';
import { cosineSimilarity } from './math';

interface Example {
  input: string;
  output: string;
  reasoning?: string;
  category?: string;
  embedding?: number[];
}

class DynamicFewShotSelector {
  private examples: Example[] = [];
  
  constructor(private opts: {
    maxExamples: number;       // æœ€å¤§ç¤ºä¾‹æ•° (3-5)
    diversityWeight: number;   // å¤šæ ·æ€§æƒé‡ (0-1)
    requireCategoryBalance: boolean;
  }) {}

  async addExample(ex: Example) {
    ex.embedding = await embed(ex.input);
    this.examples.push(ex);
  }

  async select(query: string): Promise&lt;Example[]&gt; {
    const queryEmb = await embed(query);
    
    // Step 1: è®¡ç®—ç›¸ä¼¼åº¦
    const scored = this.examples.map(ex => ({
      ...ex,
      similarity: cosineSimilarity(queryEmb, ex.embedding!)
    }));
    
    // Step 2: æ’åº
    scored.sort((a, b) => b.similarity - a.similarity);
    
    // Step 3: è´ªå¿ƒé€‰æ‹© (ç›¸ä¼¼åº¦ + å¤šæ ·æ€§)
    const selected: typeof scored = [];
    const { maxExamples, diversityWeight } = this.opts;
    
    for (const candidate of scored) {
      if (selected.length >= maxExamples) break;
      
      // å¤šæ ·æ€§æƒ©ç½šï¼šå¦‚æœå·²é€‰ä¸­ç›¸åŒç±»åˆ«ï¼Œé™ä½åˆ†æ•°
      const categoryPenalty = this.opts.requireCategoryBalance
        && selected.some(s => s.category === candidate.category)
        ? diversityWeight : 0;
      
      // ä¸å·²é€‰ç¤ºä¾‹çš„æœ€å¤§ç›¸ä¼¼åº¦ï¼ˆè¶Šç›¸ä¼¼ â†’ è¶Šå†—ä½™ï¼‰
      const redundancy = selected.length > 0
        ? Math.max(...selected.map(s => 
            cosineSimilarity(s.embedding!, candidate.embedding!)))
        : 0;
      
      const finalScore = candidate.similarity 
        - (redundancy * diversityWeight)
        - categoryPenalty;
      
      if (finalScore > 0.3) { // æœ€ä½ç›¸ä¼¼åº¦é˜ˆå€¼
        selected.push({ ...candidate, similarity: finalScore });
      }
    }
    
    // Step 4: æŒ‰ç›¸ä¼¼åº¦ä»ä½åˆ°é«˜æ’åˆ—ï¼ˆæœ€ç›¸å…³çš„æœ€å â†’ recency effectï¼‰
    return selected.sort((a, b) => a.similarity - b.similarity);
  }

  buildPrompt(systemPrompt: string, examples: Example[], query: string): string {
    const exampleBlock = examples.map((ex, i) => 
      `--- Example ${i + 1} ---\n` +
      `Input: ${ex.input}\n` +
      (ex.reasoning ? `Reasoning: ${ex.reasoning}\n` : '') +
      `Output: ${ex.output}`
    ).join('\n\n');

    return `${systemPrompt}\n\n${exampleBlock}\n\n--- Now your turn ---\nInput: ${query}\n`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const selector = new DynamicFewShotSelector({
  maxExamples: 4,
  diversityWeight: 0.3,
  requireCategoryBalance: true
});

// é¢„åŠ è½½ç¤ºä¾‹åº“
await selector.addExample({
  input: "Double charged on subscription",
  output: "billing",
  reasoning: "Payment-related issue",
  category: "billing"
});
// ... åŠ è½½æ›´å¤šç¤ºä¾‹

// è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©
const query = "My API key stopped working after the update";
const examples = await selector.select(query);
const prompt = selector.buildPrompt(SYSTEM_PROMPT, examples, query);
</code></pre>

  <div class="highlight-green">
    <strong>ğŸš€ KATE (kNN-Augmented in-conText Example selection)</strong><br>
    è¿™å°±æ˜¯ 2021 å¹´ Liu et al. æå‡ºçš„ KATE æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼šç”¨ kNN åœ¨ embedding ç©ºé—´ä¸­ä¸ºæ¯ä¸ª query åŠ¨æ€é€‰æ‹©æœ€ç›¸ä¼¼çš„ few-shot ç¤ºä¾‹ã€‚å®éªŒè¡¨æ˜ï¼ŒåŠ¨æ€é€‰æ‹©æ¯”é™æ€ç¤ºä¾‹åœ¨ GPT-3 ä¸Šæå‡ <strong>10-15%</strong> å‡†ç¡®ç‡ã€‚
  </div>

  <h2>ğŸ“Š å†³ç­–æ¡†æ¶ / Decision Framework</h2>

  <div class="diagram">
å¼€å§‹
  â”‚
  â–¼
ä»»åŠ¡å¯¹ GPT-4/Claude æ¥è¯´æ˜¯ "å¸¸è¯†" å—ï¼Ÿ
  â”‚
  â”œâ”€â”€ Yes â”€â”€â†’ Zero-shot + å¥½çš„æ ¼å¼çº¦æŸ
  â”‚            ï¼ˆç¿»è¯‘ã€æ‘˜è¦ã€ç®€å•é—®ç­”ï¼‰
  â”‚
  â””â”€â”€ No â”€â”€â†’ éœ€è¦ç‰¹å®šæ ¼å¼å—ï¼Ÿ
              â”‚
              â”œâ”€â”€ Yes â”€â”€â†’ è‡³å°‘ One-shotï¼ˆå±•ç¤ºæ ¼å¼ï¼‰
              â”‚            æ•ˆæœä¸å¤Ÿï¼ŸåŠ åˆ° 3-shot
              â”‚
              â””â”€â”€ No â”€â”€â†’ éœ€è¦åˆ†ç±»/æ‰“æ ‡ç­¾å—ï¼Ÿ
                          â”‚
                          â”œâ”€â”€ Yes â”€â”€â†’ Few-shot (æ¯ç±»1ä¸ª + è¾¹ç•Œcase)
                          â”‚            é«˜ç²¾åº¦éœ€æ±‚ï¼ŸåŠ¨æ€ Few-shot
                          â”‚
                          â””â”€â”€ No â”€â”€â†’ éœ€è¦ç‰¹å®šé£æ ¼/è¯­æ°”å—ï¼Ÿ
                                      â”‚
                                      â”œâ”€â”€ Yes â”€â”€â†’ 2-3 shotï¼ˆå±•ç¤ºé£æ ¼ï¼‰
                                      â”‚
                                      â””â”€â”€ No â”€â”€â†’ Zero-shot å¤§æ¦‚ç‡å¤Ÿäº†
  </div>

  <h2>âš ï¸ å¸¸è§é™·é˜± / Common Pitfalls</h2>

  <div class="highlight-red">
    <h4>é™·é˜± 1: Majority Label Bias</h4>
    <p>å¦‚æœ 5 ä¸ªç¤ºä¾‹ä¸­ 4 ä¸ªæ˜¯ "positive"ï¼Œæ¨¡å‹ä¼šå€¾å‘äºè¾“å‡º "positive"ã€‚<br>
    <strong>è§£å†³</strong>ï¼šä¸¥æ ¼å¹³è¡¡å„ç±»åˆ«æ•°é‡ã€‚</p>
  </div>

  <div class="highlight-red">
    <h4>é™·é˜± 2: Recency Bias</h4>
    <p>æ¨¡å‹å€¾å‘äºè¾“å‡ºä¸æœ€åä¸€ä¸ªç¤ºä¾‹ç›¸åŒçš„æ ‡ç­¾ã€‚<br>
    <strong>è§£å†³</strong>ï¼šéšæœºåŒ–é¡ºåºï¼Œæˆ–æœ‰æ„å°†æœ€ç›¸å…³çš„æ”¾æœ€åã€‚</p>
  </div>

  <div class="highlight-red">
    <h4>é™·é˜± 3: ç¤ºä¾‹è´¨é‡å·®</h4>
    <p>åƒåœ¾ç¤ºä¾‹æ¯”æ²¡æœ‰ç¤ºä¾‹æ›´ç³Ÿç³•ã€‚é”™è¯¯çš„ç¤ºä¾‹ä¼š"æ•™"æ¨¡å‹çŠ¯åŒæ ·çš„é”™ã€‚<br>
    <strong>è§£å†³</strong>ï¼šæ¯ä¸ªç¤ºä¾‹éƒ½è¦ç»è¿‡äººå·¥éªŒè¯ã€‚</p>
  </div>

  <div class="highlight-red">
    <h4>é™·é˜± 4: Token æµªè´¹</h4>
    <p>æ¯ä¸ªç¤ºä¾‹æ¶ˆè€— token = çœŸé‡‘ç™½é“¶ã€‚10 ä¸ªå†—ä½™ç¤ºä¾‹å¯èƒ½ä¸æ¯” 3 ä¸ªç²¾é€‰ç¤ºä¾‹å¥½ã€‚<br>
    <strong>è§£å†³</strong>ï¼šA/B æµ‹è¯•ä¸åŒç¤ºä¾‹æ•°é‡ï¼Œæ‰¾åˆ°è¾¹é™…æ•ˆç›Šæ‹ç‚¹ã€‚</p>
  </div>

  <h2>ğŸ†š ä¸ Fine-tuning çš„è¾¹ç•Œ / Few-shot vs Fine-tuning</h2>

  <table>
    <tr>
      <th>ç»´åº¦</th>
      <th>Few-shot Prompting</th>
      <th>Fine-tuning</th>
    </tr>
    <tr>
      <td>æ•°æ®éœ€æ±‚</td>
      <td>3-10 ä¸ªç¤ºä¾‹</td>
      <td>100-10,000+ æ¡</td>
    </tr>
    <tr>
      <td>å»¶è¿Ÿ</td>
      <td>ç¨é«˜ï¼ˆprompt æ›´é•¿ï¼‰</td>
      <td>æ›´ä½ï¼ˆæ— éœ€ç¤ºä¾‹ï¼‰</td>
    </tr>
    <tr>
      <td>æˆæœ¬/è°ƒç”¨</td>
      <td>æ›´é«˜ï¼ˆç¤ºä¾‹å  tokenï¼‰</td>
      <td>æ›´ä½ï¼ˆprompt æ›´çŸ­ï¼‰</td>
    </tr>
    <tr>
      <td>çµæ´»æ€§</td>
      <td>éšæ—¶æ”¹ç¤ºä¾‹</td>
      <td>éœ€è¦é‡æ–°è®­ç»ƒ</td>
    </tr>
    <tr>
      <td>é€‚ç”¨é˜¶æ®µ</td>
      <td>åŸå‹ â†’ ä¸­ç­‰æµé‡</td>
      <td>é«˜æµé‡ç”Ÿäº§</td>
    </tr>
    <tr>
      <td>è°ƒè¯•</td>
      <td>å®¹æ˜“ï¼ˆæ”¹ promptï¼‰</td>
      <td>å›°éš¾ï¼ˆæ”¹æ•°æ®é‡è®­ç»ƒï¼‰</td>
    </tr>
  </table>

  <div class="highlight">
    <strong>ğŸ’¡ é»„é‡‘æ³•åˆ™</strong>ï¼šå…ˆç”¨ few-shot éªŒè¯æƒ³æ³• â†’ æ•ˆæœå¥½ä½†æˆæœ¬é«˜ â†’ æ”¶é›†æ•°æ® fine-tune â†’ é™ä½æ¨ç†æˆæœ¬ã€‚è¿™æ˜¯ç”Ÿäº§åŒ–çš„å…¸å‹è·¯å¾„ã€‚
  </div>

  <h2>ğŸ’» å®æˆ˜: Prompt ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ / Production Prompt Management</h2>

  <pre><code>// ç”Ÿäº§çº§ Prompt ç®¡ç† â€” æ”¯æŒ A/B æµ‹è¯•
interface PromptVersion {
  id: string;
  mode: 'zero-shot' | 'few-shot' | 'dynamic-few-shot';
  systemPrompt: string;
  examples?: Example[];
  selector?: DynamicFewShotSelector;
  metrics: { accuracy: number; avgTokens: number; costPer1k: number };
}

class PromptManager {
  private versions: Map&lt;string, PromptVersion&gt; = new Map();
  
  async evaluate(versionId: string, testSet: TestCase[]): Promise&lt;EvalResult&gt; {
    const version = this.versions.get(versionId)!;
    let correct = 0, totalTokens = 0;
    
    for (const test of testSet) {
      let prompt: string;
      
      switch (version.mode) {
        case 'zero-shot':
          prompt = `${version.systemPrompt}\n\nInput: ${test.input}`;
          break;
        case 'few-shot':
          prompt = buildStaticFewShot(version.systemPrompt, version.examples!, test.input);
          break;
        case 'dynamic-few-shot':
          const selected = await version.selector!.select(test.input);
          prompt = version.selector!.buildPrompt(version.systemPrompt, selected, test.input);
          break;
      }
      
      const result = await llm.complete(prompt);
      if (result.output === test.expected) correct++;
      totalTokens += result.usage.totalTokens;
    }
    
    return {
      accuracy: correct / testSet.length,
      avgTokens: totalTokens / testSet.length,
      costPer1k: (totalTokens / testSet.length) * PRICE_PER_TOKEN * 1000
    };
  }
  
  // é€‰æ‹©èµ¢å®¶: å‡†ç¡®ç‡ä¼˜å…ˆï¼Œæˆæœ¬ä½œä¸º tiebreaker
  selectWinner(results: Map&lt;string, EvalResult&gt;): string {
    return [...results.entries()]
      .sort((a, b) => {
        const accDiff = b[1].accuracy - a[1].accuracy;
        if (Math.abs(accDiff) > 0.02) return accDiff; // >2% å·®å¼‚çœ‹å‡†ç¡®ç‡
        return a[1].costPer1k - b[1].costPer1k;       // å¦åˆ™çœ‹æˆæœ¬
      })[0][0];
  }
}</code></pre>

  <h2>ğŸ“š å¯å­¦ä¹ çš„æ¨¡å¼ / Patterns to Apply</h2>

  <div class="pattern">
    <h4>Pattern 1: Zero-shot First åŸåˆ™</h4>
    <p>ä»»ä½•æ–°ä»»åŠ¡ï¼Œå…ˆè¯• zero-shot + è¯¦ç»†æŒ‡ä»¤ã€‚åªåœ¨æ•ˆæœä¸è¾¾æ ‡æ—¶æ‰åŠ ç¤ºä¾‹ã€‚è¿™èƒ½å¸®ä½ ç†è§£æ¨¡å‹ã€Œæœ¬æ¥å°±ä¼šä»€ä¹ˆã€å’Œã€Œéœ€è¦æ•™ä»€ä¹ˆã€ã€‚</p>
  </div>

  <div class="pattern">
    <h4>Pattern 2: Example as Test Case</h4>
    <p>ä½ çš„ few-shot ç¤ºä¾‹å°±æ˜¯ä½ çš„ç¬¬ä¸€æ‰¹æµ‹è¯•ç”¨ä¾‹ã€‚å¦‚æœç¤ºä¾‹è¦†ç›–äº†æ‰€æœ‰è¾¹ç•Œ caseï¼Œä½ çš„ prompt å°±å¤©ç„¶å…·å¤‡äº†ã€Œspecification by exampleã€çš„æ€§è´¨ã€‚</p>
  </div>

  <div class="pattern">
    <h4>Pattern 3: Dynamic Selection for Scale</h4>
    <p>å½“ç¤ºä¾‹åº“è¶…è¿‡ 10 ä¸ªæ—¶ï¼Œå¿…é¡»å¼•å…¥åŠ¨æ€é€‰æ‹©ã€‚é™æ€ few-shot åœ¨è§„æ¨¡åŒ–æ—¶ token æˆæœ¬ä¼šçˆ†ç‚¸ï¼Œä¸”ç›¸å…³æ€§ä¼šä¸‹é™ã€‚</p>
  </div>

  <div class="pattern">
    <h4>Pattern 4: Prompt ç‰ˆæœ¬åŒ– = ä»£ç ç‰ˆæœ¬åŒ–</h4>
    <p>Prompt çš„å˜æ›´åº”è¯¥åƒä»£ç ä¸€æ ·æœ‰ç‰ˆæœ¬æ§åˆ¶ã€A/B æµ‹è¯•ã€å›æ»šèƒ½åŠ›ã€‚åœ¨ OpenClaw/Friday è¿™ç§ç³»ç»Ÿä¸­ï¼Œprompt å°±æ˜¯æ ¸å¿ƒé€»è¾‘ã€‚</p>
  </div>

  <h2>ğŸ¤ é¢è¯•é«˜é¢‘é—®é¢˜ / Interview Questions</h2>

  <div class="interview">
    <h4>Q1: ä»€ä¹ˆæ—¶å€™ç”¨ few-shotï¼Œä»€ä¹ˆæ—¶å€™ç”¨ fine-tuningï¼Ÿ</h4>
    <p><strong>ç­”é¢˜æ¡†æ¶</strong>ï¼šæ•°æ®é‡ â†’ æµé‡ â†’ å»¶è¿Ÿè¦æ±‚ â†’ çµæ´»æ€§éœ€æ±‚ã€‚<br>
    Few-shot: æ•°æ®å°‘(<100æ¡)ã€éœ€è¦å¿«é€Ÿè¿­ä»£ã€ä»»åŠ¡å¯èƒ½å˜åŒ–ã€‚<br>
    Fine-tune: æ•°æ®å¤š(1000+æ¡)ã€é«˜æµé‡(é™ä½per-callæˆæœ¬)ã€å»¶è¿Ÿæ•æ„Ÿ(shorter prompt)ã€ä»»åŠ¡ç¨³å®šã€‚<br>
    ç”Ÿäº§è·¯å¾„: Zero-shot â†’ Few-shot â†’ æ”¶é›†æ•°æ® â†’ Fine-tuneã€‚</p>
  </div>

  <div class="interview">
    <h4>Q2: Few-shot ç¤ºä¾‹é€‰ä¸å¥½ä¼šæ€æ ·ï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h4>
    <p><strong>ä¸‰ç§å¤±è´¥æ¨¡å¼</strong>ï¼š<br>
    1) Majority bias â€” ç±»åˆ«ä¸å‡è¡¡å¯¼è‡´åå‘å¤šæ•°ç±» â†’ å¹³è¡¡ç¤ºä¾‹<br>
    2) Recency bias â€” æ¨¡å‹å€¾å‘é‡å¤æœ€åä¸€ä¸ªç¤ºä¾‹çš„æ ‡ç­¾ â†’ éšæœºåŒ–é¡ºåº<br>
    3) Irrelevant examples â€” ä¸ query ä¸ç›¸å…³çš„ç¤ºä¾‹åè€Œå¼•å…¥å™ªéŸ³ â†’ åŠ¨æ€é€‰æ‹© (KATE/kNN)<br>
    ä¼˜åŒ–: embedding ç›¸ä¼¼åº¦ç­›é€‰ + å¤šæ ·æ€§çº¦æŸ + A/B æµ‹è¯•</p>
  </div>

  <div class="interview">
    <h4>Q3: å¦‚ä½•åœ¨ç”Ÿäº§ä¸­ç®¡ç† prompt ç‰ˆæœ¬å’Œ A/B æµ‹è¯•ï¼Ÿ</h4>
    <p><strong>å››å±‚æ¶æ„</strong>ï¼š<br>
    1) Prompt Registry â€” ç‰ˆæœ¬åŒ–å­˜å‚¨æ‰€æœ‰ prompt å˜ä½“<br>
    2) Traffic Router â€” æŒ‰æ¯”ä¾‹åˆ†é…æµé‡åˆ°ä¸åŒç‰ˆæœ¬<br>
    3) Eval Pipeline â€” è‡ªåŠ¨è¯„ä¼°å‡†ç¡®ç‡/å»¶è¿Ÿ/æˆæœ¬<br>
    4) Promotion Logic â€” åŸºäºç»Ÿè®¡æ˜¾è‘—æ€§è‡ªåŠ¨é€‰æ‹©èµ¢å®¶<br>
    å·¥å…·: LangSmith, Humanloop, æˆ–è‡ªå»º (å‚è€ƒ Day 1 ç³»åˆ—ä¸­ ML A/B Testing)</p>
  </div>

  <div class="interview">
    <h4>Q4: å¦‚ä½•å‡å°‘ few-shot çš„ token æˆæœ¬ï¼Ÿ</h4>
    <p><strong>äº”ç§ç­–ç•¥</strong>ï¼š<br>
    1) åŠ¨æ€é€‰æ‹© â€” åªç”¨æœ€ç›¸å…³çš„ 2-3 ä¸ªï¼Œè€Œä¸æ˜¯å›ºå®š 5-8 ä¸ª<br>
    2) ç¤ºä¾‹å‹ç¼© â€” ç”¨æœ€ç®€æ´çš„è¡¨è¿°ï¼Œåˆ é™¤å†—ä½™ç»†èŠ‚<br>
    3) Prefix caching â€” åˆ©ç”¨ Anthropic/OpenAI çš„ prompt caching (ç›¸åŒå‰ç¼€åªè®¡è´¹ä¸€æ¬¡)<br>
    4) æ¢¯åº¦: zero-shot â†’ one-shot â†’ few-shotï¼ŒæŒ‰éœ€å‡çº§<br>
    5) ç»ˆææ–¹æ¡ˆ: æ”¶é›†è¶³å¤Ÿæ•°æ®å fine-tuneï¼Œå½»åº•æ¶ˆé™¤ prompt ä¸­çš„ç¤ºä¾‹</p>
  </div>

  <h2>ğŸ§  æ€è€ƒé¢˜ / Think About It</h2>
  <div class="highlight">
    <p><strong>ä½ åœ¨ OpenClaw çš„ SOUL.md / AGENTS.md ä¸­å†™çš„ personality å’Œ rulesï¼Œæœ¬è´¨ä¸Šæ˜¯ zero-shot è¿˜æ˜¯ few-shotï¼Ÿ</strong></p>
    <p>å¦‚æœ SOUL.md ä¸­è¯´ã€Œè¯­æ°”è¦ä¸“ä¸šä½†ä¸æ¯ç‡¥ã€ï¼Œè¿™æ˜¯ zero-shot çš„ <em>æè¿°æ€§æŒ‡ä»¤</em>ã€‚å¦‚æœä½ åŠ å‡ ä¸ªã€Œå¥½çš„å›å¤ vs å·®çš„å›å¤ã€å¯¹æ¯”ï¼Œè¿™å°±å˜æˆäº† few-shotã€‚å“ªç§æ•ˆæœæ›´å¥½ï¼Ÿå€¼å¾—å®éªŒã€‚</p>
  </div>

  <div class="follow-up">
    <h3>ğŸ’¬ åç»­è®¨è®º / Follow-up Discussion</h3>
    <p>Day 3 é¢„å‘Šï¼š<strong>System Prompt è®¾è®¡æ¨¡å¼</strong> â€” å¦‚ä½•ç»“æ„åŒ–ä½ çš„ system promptï¼Œä»è§’è‰²è®¾å®šåˆ°è¾“å‡ºçº¦æŸçš„å®Œæ•´æ¡†æ¶ã€‚</p>
    <p>Day 1 CoT + Day 2 Few-shot â†’ Day 3 å°†è¿™äº›æŠ€å·§ç»„åˆè¿›ä¸€ä¸ªå®Œæ•´çš„ System Prompt æ¶æ„ä¸­ã€‚</p>
  </div>
</body>
</html>
