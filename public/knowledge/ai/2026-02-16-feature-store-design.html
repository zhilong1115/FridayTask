<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>2026-02-16 - Feature Store è®¾è®¡ï¼šML ç³»ç»Ÿçš„æ•°æ®åŸºåº§</title>
  <style>
    body { font-family: -apple-system, system-ui, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; line-height: 1.7; color: #333; }
    .bilingual { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0; }
    .zh { border-left: 3px solid #f9ab00; padding-left: 15px; }
    .en { border-left: 3px solid #1a73e8; padding-left: 15px; }
    h1 { color: #1a73e8; border-bottom: 2px solid #e8eaed; padding-bottom: 10px; }
    h2 { color: #3c4043; margin-top: 35px; }
    h3 { color: #5f6368; }
    .architecture { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
    pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 14px; }
    code { font-family: 'SF Mono', Monaco, monospace; }
    .highlight { background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .highlight-blue { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .highlight-green { background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .highlight-red { background: #fce4ec; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .diagram { text-align: left; margin: 20px 0; background: #f8f9fa; padding: 20px; border-radius: 8px; }
    .diagram pre { background: #263238; color: #aed581; }
    .interview { background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9c27b0; }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; }
    th, td { border: 1px solid #dadce0; padding: 10px; text-align: left; }
    th { background: #f1f3f4; }
    .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
    .tag-online { background: #e8f5e9; color: #2e7d32; }
    .tag-offline { background: #e3f2fd; color: #1565c0; }
    .tag-streaming { background: #fff3e0; color: #e65100; }
    .follow-up { margin-top: 30px; padding: 15px; border: 1px dashed #dadce0; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ—„ï¸ Feature Store è®¾è®¡ï¼šML ç³»ç»Ÿçš„æ•°æ®åŸºåº§</h1>
  <p>ğŸ“… 2026-02-16 | Phase 2.2 ML System Design è¦ç‚¹ Day 2 | æ‰¿æ¥ Day 1 ä¸ƒå¤§ Pattern</p>

  <h2>ğŸ“– ä¸ºä»€ä¹ˆéœ€è¦ Feature Storeï¼Ÿ</h2>
  <div class="bilingual">
    <div class="zh">
      <p>åœ¨ Day 1 çš„ä¸ƒå¤§ Pattern ä¸­ï¼Œæˆ‘ä»¬åå¤æåˆ° <strong>Offline/Online Split</strong> å’Œ <strong>Multi-Layer Caching</strong>ã€‚Feature Store æ­£æ˜¯è¿™ä¸¤ä¸ª Pattern åœ¨æ•°æ®å±‚çš„å…·ä½“åŒ–ã€‚</p>
      <p>æ ¸å¿ƒé—®é¢˜åªæœ‰ä¸€ä¸ªï¼š<strong>Training-Serving Skew</strong>ï¼ˆè®­ç»ƒ-æ¨ç†åå·®ï¼‰ã€‚è®­ç»ƒæ—¶ç”¨ Spark SQL ç®—çš„ç‰¹å¾ï¼Œä¸Šçº¿æ—¶ç”¨ Python é‡å†™ä¸€éâ€”â€”é€»è¾‘ä¸ä¸€è‡´å¯¼è‡´çº¿ä¸Šæ•ˆæœè«åå˜å·®ï¼Œè¿™æ˜¯ ML ç”Ÿäº§ç³»ç»Ÿæœ€éšè”½çš„ bugã€‚</p>
    </div>
    <div class="en">
      <p>In Day 1's 7 Patterns, we kept referencing <strong>Offline/Online Split</strong> and <strong>Multi-Layer Caching</strong>. Feature Store is the data-layer materialization of both.</p>
      <p>The core problem: <strong>Training-Serving Skew</strong>. Features computed via Spark SQL during training get re-implemented in Python for servingâ€”logic inconsistency causes mysterious production degradation. This is ML's most insidious bug class.</p>
    </div>
  </div>

  <div class="highlight-red">
    <h4>âš ï¸ æ²¡æœ‰ Feature Store çš„ä¸–ç•Œ</h4>
    <p><strong>Team A</strong> ç”¨ PySpark ç®— user_avg_purchase â†’ å­˜ S3 è®­ç»ƒ â†’ æ¨¡å‹ AUC 0.92</p>
    <p><strong>Team B</strong> ä¸Šçº¿æ—¶ç”¨ Redis + Python é‡å†™åŒä¸€ç‰¹å¾ â†’ ç²¾åº¦å·®å¼‚ â†’ çº¿ä¸Š AUC 0.87</p>
    <p><strong>Team C</strong> éœ€è¦åŒæ ·ç‰¹å¾ï¼Œä¸çŸ¥é“å·²ç»æœ‰äººåšäº† â†’ ä»å¤´å†™ç¬¬ä¸‰é</p>
    <p>ğŸ’° é‡å¤åŠ³åŠ¨ + ä¸€è‡´æ€§ bug + æ— æ³•å®¡è®¡ = æ¯å¹´ç™¾ä¸‡çº§æŸå¤±</p>
  </div>

  <h2>ğŸ—ï¸ Feature Store æ ¸å¿ƒæ¶æ„</h2>

  <div class="diagram">
    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FEATURE STORE ARCHITECTURE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Raw Data â”‚â”€â”€â”€â–¶â”‚ Transformation   â”‚â”€â”€â”€â–¶â”‚  Feature Registry â”‚   â”‚
â”‚  â”‚ Sources  â”‚    â”‚ Engine           â”‚    â”‚  (Metadata + SDK) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â€¢ Kafka                 â”‚                       â”‚               â”‚
â”‚   â€¢ S3/GCS                â”‚                       â”‚               â”‚
â”‚   â€¢ Databases       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           Version Control      â”‚
â”‚   â€¢ APIs            â”‚           â”‚           Lineage Tracking      â”‚
â”‚                     â–¼           â–¼           Access Control        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚  Offline   â”‚ â”‚  Online  â”‚                          â”‚
â”‚              â”‚  Store     â”‚ â”‚  Store   â”‚                          â”‚
â”‚              â”‚ (S3/BQ/    â”‚ â”‚ (Redis/  â”‚                          â”‚
â”‚              â”‚  Hive)     â”‚ â”‚  DynamoDB)â”‚                         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚
â”‚                    â”‚              â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚  Training  â”‚ â”‚ Serving  â”‚                          â”‚
â”‚              â”‚  Pipeline  â”‚ â”‚ Pipeline â”‚                          â”‚
â”‚              â”‚ (Batch)    â”‚ â”‚ (Real-   â”‚                          â”‚
â”‚              â”‚            â”‚ â”‚  time)   â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WRITE ONCE, READ EVERYWHERE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
  </div>

  <h3>å››å¤§æ ¸å¿ƒç»„ä»¶</h3>
  <table>
    <tr>
      <th>ç»„ä»¶</th>
      <th>èŒè´£</th>
      <th>æŠ€æœ¯é€‰å‹</th>
      <th>å¯¹åº” Day 1 Pattern</th>
    </tr>
    <tr>
      <td><strong>Transformation Engine</strong></td>
      <td>ç‰¹å¾è®¡ç®—é€»è¾‘ï¼Œå®šä¹‰ä¸€æ¬¡å¤ç”¨å¤šå¤„</td>
      <td>Spark, Flink, SQL, Python UDF</td>
      <td>Offline/Online Split</td>
    </tr>
    <tr>
      <td><strong>Offline Store</strong></td>
      <td>å†å²ç‰¹å¾ï¼Œç”¨äºè®­ç»ƒå’Œå›å¡«</td>
      <td>S3, BigQuery, Hive, Delta Lake</td>
      <td>Multi-Layer Caching (Cold)</td>
    </tr>
    <tr>
      <td><strong>Online Store</strong></td>
      <td>æœ€æ–°ç‰¹å¾å€¼ï¼Œç”¨äºå®æ—¶æ¨ç† (p99 < 10ms)</td>
      <td>Redis, DynamoDB, Bigtable</td>
      <td>Multi-Layer Caching (Hot)</td>
    </tr>
    <tr>
      <td><strong>Feature Registry</strong></td>
      <td>å…ƒæ•°æ®ã€ç‰ˆæœ¬æ§åˆ¶ã€è¡€ç¼˜è¿½è¸ªã€æƒé™</td>
      <td>Catalog service, Git-like versioning</td>
      <td>Guardrails & Verification</td>
    </tr>
  </table>

  <h2>ğŸ”‘ ä¸‰ç§æ¶æ„æ¨¡å¼</h2>

  <div class="bilingual">
    <div class="zh">
      <p>ä¸šç•Œ Feature Store æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œç†è§£å®ƒä»¬çš„åŒºåˆ«æ˜¯é¢è¯•å¸¸è€ƒç‚¹ã€‚</p>
    </div>
    <div class="en">
      <p>Industry Feature Store architectures fall into three categoriesâ€”understanding their tradeoffs is a common interview topic.</p>
    </div>
  </div>

  <h3>1ï¸âƒ£ Literal Feature Storeï¼ˆå­—é¢å‹ï¼‰</h3>
  <div class="highlight">
    <p><strong>ä»£è¡¨</strong>: Hopsworks</p>
    <p><strong>ç†å¿µ</strong>: Feature Store å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®åº“ï¼Œè‡ªå·±ç®¡ç†å­˜å‚¨å’Œè®¡ç®—ã€‚</p>
    <p><strong>ç‰¹ç‚¹</strong>: è‡ªå¸¦ Spark é›†ç¾¤ + åœ¨çº¿/ç¦»çº¿å­˜å‚¨ + UIã€‚All-in-oneã€‚</p>
    <p><strong>ä¼˜ç‚¹</strong>: å¼€ç®±å³ç”¨ï¼Œä¸€è‡´æ€§æœ€å¼ºï¼ˆä¸€å¥—ç³»ç»Ÿç®¡æ‰€æœ‰ï¼‰</p>
    <p><strong>ç¼ºç‚¹</strong>: é‡ã€è´µã€lock-inã€‚éœ€è¦è¿ç§»æ•°æ®åˆ°å®ƒçš„ç”Ÿæ€ã€‚</p>
  </div>

  <h3>2ï¸âƒ£ Physical Feature Storeï¼ˆç‰©ç†å‹ï¼‰</h3>
  <div class="highlight-blue">
    <p><strong>ä»£è¡¨</strong>: Tecton (åŸºäº Uber Michelangelo)</p>
    <p><strong>ç†å¿µ</strong>: ç®¡ç† Feature Pipeline çš„ç¼–æ’å’Œç‰©åŒ–ï¼Œä½†ç”¨ä½ å·²æœ‰çš„åŸºç¡€è®¾æ–½ã€‚</p>
    <p><strong>ç‰¹ç‚¹</strong>: ä½ å®šä¹‰ç‰¹å¾é€»è¾‘ â†’ Tecton è´Ÿè´£åœ¨ Spark/Flink ä¸Šè¿è¡Œ â†’ ç‰©åŒ–åˆ° Redis/DynamoDBã€‚</p>
    <p><strong>ä¼˜ç‚¹</strong>: ç”Ÿäº§çº§å®æ—¶ç‰¹å¾ã€å†…ç½®è°ƒåº¦ã€å¼ºä¸€è‡´æ€§ä¿è¯</p>
    <p><strong>ç¼ºç‚¹</strong>: æ‰˜ç®¡æœåŠ¡è´µ (~$5K-50K/mo)ã€éœ€è¦ Tecton è¿è¡Œä½ çš„è®¡ç®—</p>
  </div>

  <h3>3ï¸âƒ£ Virtual Feature Storeï¼ˆè™šæ‹Ÿå‹ï¼‰</h3>
  <div class="highlight-green">
    <p><strong>ä»£è¡¨</strong>: Feast (å¼€æº), Featureform</p>
    <p><strong>ç†å¿µ</strong>: ä¸è¿è¡Œè®¡ç®—ï¼Œåªåšæ³¨å†Œã€è¿½è¸ªå’ŒæœåŠ¡å±‚ã€‚ç‰¹å¾è®¡ç®—ä½ è‡ªå·±ç®¡ã€‚</p>
    <p><strong>ç‰¹ç‚¹</strong>: å£°æ˜å¼å®šä¹‰ â†’ ä»ä½ å·²æœ‰çš„æ•°æ®æºè¯»å– â†’ ç‰©åŒ–åˆ° Online Storeã€‚</p>
    <p><strong>ä¼˜ç‚¹</strong>: è½»é‡ã€å¼€æºã€ä¸ lock-inã€é€‚åˆå·²æœ‰ data infra çš„å›¢é˜Ÿ</p>
    <p><strong>ç¼ºç‚¹</strong>: å®æ—¶ç‰¹å¾èƒ½åŠ›å¼±ã€éœ€è¦è‡ªå·±ç®¡ç¼–æ’</p>
  </div>

  <table>
    <tr>
      <th>ç»´åº¦</th>
      <th>Literal (Hopsworks)</th>
      <th>Physical (Tecton)</th>
      <th>Virtual (Feast)</th>
    </tr>
    <tr><td>è®¡ç®—ç®¡ç†</td><td>âœ… è‡ªå¸¦</td><td>âœ… æ‰˜ç®¡ç¼–æ’</td><td>âŒ è‡ªå·±ç®¡</td></tr>
    <tr><td>å­˜å‚¨ç®¡ç†</td><td>âœ… è‡ªå¸¦</td><td>âš¡ ç”¨ä½ çš„ infra</td><td>âš¡ ç”¨ä½ çš„ infra</td></tr>
    <tr><td>å®æ—¶ç‰¹å¾</td><td>âš¡ æœ‰é™</td><td>âœ… ä¸€æµ</td><td>âš ï¸ åŸºç¡€</td></tr>
    <tr><td>æˆæœ¬</td><td>ä¸­-é«˜</td><td>é«˜</td><td>ä½</td></tr>
    <tr><td>é€‚åˆå›¢é˜Ÿ</td><td>å°å›¢é˜Ÿå¿«é€Ÿå¯åŠ¨</td><td>å¤§å‚ç”Ÿäº§çº§</td><td>å·²æœ‰ data infra</td></tr>
  </table>

  <h2>ğŸ’» Feast ä»£ç å®æˆ˜</h2>

  <div class="bilingual">
    <div class="zh">
      <p>Feast æ˜¯æœ€æµè¡Œçš„å¼€æº Feature Storeï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­æœ€å¸¸è¢«é—®åˆ°çš„ã€‚æ¥çœ‹å®Œæ•´çš„å®šä¹‰â†’ç‰©åŒ–â†’æœåŠ¡æµç¨‹ã€‚</p>
    </div>
    <div class="en">
      <p>Feast is the most popular open-source Feature Store and the most likely to appear in interviews. Let's walk through the full defineâ†’materializeâ†’serve flow.</p>
    </div>
  </div>

  <h3>Step 1: å®šä¹‰ Feature View</h3>
  <pre><code># feature_repo/features.py
from feast import Entity, FeatureView, Field, FileSource
from feast.types import Float32, Int64
from datetime import timedelta

# æ•°æ®æº (ç¦»çº¿)
user_purchases = FileSource(
    path="s3://data-lake/user_purchases.parquet",
    timestamp_field="event_timestamp",
)

# å®ä½“ = ç‰¹å¾çš„ä¸»é”®
user = Entity(name="user_id", join_keys=["user_id"])

# Feature View = ä¸€ç»„ç›¸å…³ç‰¹å¾çš„é€»è¾‘åˆ†ç»„
user_purchase_features = FeatureView(
    name="user_purchase_features",
    entities=[user],
    ttl=timedelta(days=90),    # ç‰¹å¾è¿‡æœŸæ—¶é—´
    schema=[
        Field(name="avg_purchase_price", dtype=Float32),
        Field(name="total_purchases_30d", dtype=Int64),
        Field(name="purchase_frequency", dtype=Float32),
    ],
    online=True,                # ç‰©åŒ–åˆ°åœ¨çº¿å­˜å‚¨
    source=user_purchases,
)</code></pre>

  <h3>Step 2: ç‰©åŒ–åˆ° Online Store</h3>
  <pre><code># å°†ç¦»çº¿æ•°æ®ç‰©åŒ–åˆ° Redis/DynamoDB
feast materialize-incremental $(date +%Y-%m-%dT%H:%M:%S)

# æˆ–åœ¨ Python ä¸­
from feast import FeatureStore
store = FeatureStore(repo_path="feature_repo/")
store.materialize_incremental(end_date=datetime.now())</code></pre>

  <h3>Step 3: è®­ç»ƒæ—¶è·å–å†å²ç‰¹å¾ (Point-in-Time Join)</h3>
  <pre><code># Point-in-Time Join â€” Feature Store æœ€æ ¸å¿ƒçš„èƒ½åŠ›
# é¿å… data leakage: åªç”¨äº‹ä»¶å‘ç”Ÿæ—¶åˆ»ä¹‹å‰çš„ç‰¹å¾å€¼

entity_df = pd.DataFrame({
    "user_id": [1001, 1002, 1003],
    "event_timestamp": [
        datetime(2026, 2, 10),  # åªå– 2/10 ä¹‹å‰çš„ç‰¹å¾
        datetime(2026, 2, 12),  # åªå– 2/12 ä¹‹å‰çš„ç‰¹å¾
        datetime(2026, 2, 15),  # åªå– 2/15 ä¹‹å‰çš„ç‰¹å¾
    ],
})

# Feast è‡ªåŠ¨åš point-in-time joinï¼Œé˜²æ­¢æœªæ¥ä¿¡æ¯æ³„éœ²
training_df = store.get_historical_features(
    entity_df=entity_df,
    features=[
        "user_purchase_features:avg_purchase_price",
        "user_purchase_features:total_purchases_30d",
        "user_purchase_features:purchase_frequency",
    ],
).to_df()

# ç›´æ¥ç”¨äºè®­ç»ƒ â€” å’Œåœ¨çº¿æ¨ç†ç”¨çš„æ˜¯åŒä¸€å¥—ç‰¹å¾å®šä¹‰ï¼
model.fit(training_df[feature_cols], training_df["label"])</code></pre>

  <h3>Step 4: æ¨ç†æ—¶è·å–åœ¨çº¿ç‰¹å¾</h3>
  <pre><code># åœ¨çº¿æ¨ç† â€” ä» Redis/DynamoDB è¯»å–ï¼Œå»¶è¿Ÿ < 10ms
features = store.get_online_features(
    features=[
        "user_purchase_features:avg_purchase_price",
        "user_purchase_features:total_purchases_30d",
    ],
    entity_rows=[{"user_id": 1001}],
).to_dict()

# Output: {"avg_purchase_price": [42.5], "total_purchases_30d": [7]}
prediction = model.predict(features)</code></pre>

  <div class="highlight">
    <h4>ğŸ”‘ å…³é”®æ´å¯Ÿï¼šWrite Once, Read Everywhere</h4>
    <p>ç‰¹å¾é€»è¾‘åªå®šä¹‰ä¸€æ¬¡ï¼ˆStep 1ï¼‰ï¼Œè®­ç»ƒï¼ˆStep 3ï¼‰å’Œæ¨ç†ï¼ˆStep 4ï¼‰è¯»çš„æ˜¯åŒä¸€ä¸ªå®šä¹‰äº§ç”Ÿçš„æ•°æ®ã€‚<strong>Training-Serving Skew = 0</strong>ã€‚</p>
  </div>

  <h2>â° ä¸‰ç§ç‰¹å¾è®¡ç®—æ¨¡å¼</h2>

  <table>
    <tr>
      <th>æ¨¡å¼</th>
      <th>å»¶è¿Ÿ</th>
      <th>æ–°é²œåº¦</th>
      <th>é€‚ç”¨åœºæ™¯</th>
      <th>æŠ€æœ¯æ ˆ</th>
    </tr>
    <tr>
      <td><span class="tag tag-offline">Batch</span></td>
      <td>åˆ†é’Ÿ-å°æ—¶</td>
      <td>T+1 æˆ–å®šæ—¶</td>
      <td>ç”¨æˆ·ç”»åƒã€å†å²ç»Ÿè®¡</td>
      <td>Spark, Airflow, dbt</td>
    </tr>
    <tr>
      <td><span class="tag tag-streaming">Streaming</span></td>
      <td>ç§’çº§</td>
      <td>è¿‘å®æ—¶</td>
      <td>å®æ—¶ç‚¹å‡»ç‡ã€æ¬ºè¯ˆæ£€æµ‹</td>
      <td>Flink, Spark Streaming, Kafka Streams</td>
    </tr>
    <tr>
      <td><span class="tag tag-online">On-Demand</span></td>
      <td>æ¯«ç§’</td>
      <td>å®æ—¶</td>
      <td>è¯·æ±‚ä¸Šä¸‹æ–‡ã€åœ°ç†ä½ç½®</td>
      <td>Python UDF, Feature Server</td>
    </tr>
  </table>

  <div class="diagram">
    <pre>
ç”Ÿäº§çº§ç³»ç»Ÿé€šå¸¸ä¸‰ç§å¹¶ç”¨ï¼š

Request â”€â”€â”€â”€â”€â”
             â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Feature Server    â”‚
   â”‚                     â”‚
   â”‚  On-Demand Features â”‚â—€â”€â”€ è¯·æ±‚ä¸Šä¸‹æ–‡ (device, IP, time)
   â”‚  + Streaming Cache  â”‚â—€â”€â”€ Flink çª—å£èšåˆ (last_5min_clicks)
   â”‚  + Batch Lookup     â”‚â—€â”€â”€ Redis ç‰©åŒ– (user_profile, 30d_stats)
   â”‚                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ åˆå¹¶ç‰¹å¾å‘é‡
             â–¼
        Model Inference</pre>
  </div>

  <h2>ğŸ¯ Point-in-Time Join æ·±å…¥</h2>

  <div class="bilingual">
    <div class="zh">
      <p>Point-in-Time Join æ˜¯ Feature Store æœ€æ ¸å¿ƒä¹Ÿæœ€å®¹æ˜“å‡º bug çš„èƒ½åŠ›ã€‚é¢è¯•å¿…é—®ã€‚</p>
      <p><strong>é—®é¢˜</strong>ï¼šè®­ç»ƒæ•°æ®ä¸­ï¼Œæ¯æ¡æ ·æœ¬å‘ç”Ÿåœ¨ä¸åŒæ—¶é—´ã€‚æˆ‘ä»¬éœ€è¦è·å–"é‚£ä¸ªæ—¶é—´ç‚¹èƒ½çœ‹åˆ°çš„ç‰¹å¾å€¼"ï¼Œè€Œä¸æ˜¯æœ€æ–°å€¼â€”â€”å¦åˆ™å°±æ˜¯<strong>æ•°æ®æ³„éœ² (Data Leakage)</strong>ã€‚</p>
    </div>
    <div class="en">
      <p>Point-in-Time Join is the Feature Store's most critical and error-prone capability. Always asked in interviews.</p>
      <p><strong>Problem</strong>: Each training sample occurs at different times. We must retrieve "the feature values visible at that point in time"â€”not the latest valuesâ€”otherwise we have <strong>Data Leakage</strong>.</p>
    </div>
  </div>

  <div class="diagram">
    <pre>
Feature Timeline:
              t1         t2         t3
user_1001: â”€â”€[val=10]â”€â”€â”€[val=25]â”€â”€â”€[val=42]â”€â”€â–¶

Training Samples:
  Sample A @ t1.5 â†’ åº”è¯¥ç”¨ val=10 (ä¸èƒ½çœ‹åˆ° t2 çš„ 25)
  Sample B @ t2.5 â†’ åº”è¯¥ç”¨ val=25 (ä¸èƒ½çœ‹åˆ° t3 çš„ 42)

é”™è¯¯åšæ³• (å¸¸è§ bug):
  ç›´æ¥ç”¨æœ€æ–°å€¼ val=42 â†’ ğŸš¨ Data Leakage!
  æ¨¡å‹è®­ç»ƒ AUC 0.95ï¼Œä¸Šçº¿ AUC 0.80 â†’ ç»å…¸ç¿»è½¦</pre>
  </div>

  <div class="highlight-red">
    <h4>ğŸš¨ é¢è¯•é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ JOINï¼Ÿ</h4>
    <p>æ™®é€š SQL JOIN æ‹¿åˆ°çš„æ˜¯"æœ€æ–°å€¼"æˆ–"ç²¾ç¡®åŒ¹é…"ã€‚Point-in-Time Join éœ€è¦ <strong>AS OF è¯­ä¹‰</strong>ï¼šå¯¹æ¯æ¡è®°å½•ï¼Œæ‰¾åˆ° â‰¤ event_timestamp çš„æœ€æ–°ç‰¹å¾å€¼ã€‚è¿™åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šæ˜¯ O(n log n) çš„æ’åºåˆå¹¶æ“ä½œã€‚</p>
  </div>

  <h2>ğŸ¢ å¤§å‚å®æˆ˜æ¡ˆä¾‹</h2>

  <table>
    <tr>
      <th>å…¬å¸</th>
      <th>Feature Store</th>
      <th>è§„æ¨¡</th>
      <th>å…³é”®è®¾è®¡</th>
    </tr>
    <tr>
      <td><strong>Uber</strong> (Michelangelo)</td>
      <td>è‡ªå»º â†’ Tecton</td>
      <td>ä¸‡çº§ç‰¹å¾, ç™¾ä¸‡çº§ QPS</td>
      <td>Feature Pipeline as Code, ä¸‰å±‚å­˜å‚¨</td>
    </tr>
    <tr>
      <td><strong>Robinhood</strong></td>
      <td>Feast (è‡ªå»º)</td>
      <td>åƒçº§ç‰¹å¾</td>
      <td>DynamoDB Online Store, Airflow ç¼–æ’</td>
    </tr>
    <tr>
      <td><strong>Netflix</strong></td>
      <td>è‡ªå»º (Cosmos)</td>
      <td>ä¸‡çº§ç‰¹å¾</td>
      <td>Apache Iceberg ç¦»çº¿, Cassandra åœ¨çº¿</td>
    </tr>
    <tr>
      <td><strong>Airbnb</strong> (Zipline)</td>
      <td>è‡ªå»º</td>
      <td>ä¸‡çº§ç‰¹å¾, åƒçº§æ¨¡å‹</td>
      <td>æ—¶é—´æ—…è¡Œ backfill, è‡ªåŠ¨ Point-in-Time Join</td>
    </tr>
    <tr>
      <td><strong>Stripe</strong></td>
      <td>è‡ªå»º</td>
      <td>å®æ—¶æ¬ºè¯ˆæ£€æµ‹</td>
      <td>Streaming + Batch åŒè½¨ï¼Œäºšç§’çº§æ–°é²œåº¦</td>
    </tr>
  </table>

  <h2>ğŸ“ å®¹é‡ä¼°ç®— (é¢è¯•ç”¨)</h2>
  <div class="architecture">
    <h4>åœºæ™¯ï¼šä¸­å‹ç”µå•†å¹³å° Feature Store</h4>
    <ul>
      <li><strong>ç”¨æˆ·æ•°</strong>: 10M</li>
      <li><strong>ç‰¹å¾æ•°</strong>: 500 ä¸ªç‰¹å¾ (åˆ† 30 ä¸ª Feature View)</li>
      <li><strong>å¹³å‡ç‰¹å¾å¤§å°</strong>: æ¯ç”¨æˆ· ~2KB (500 Ã— 4 bytes)</li>
      <li><strong>Online Store æ€»é‡</strong>: 10M Ã— 2KB = <strong>20GB</strong> (Redis å•æœºå¯æ‰›)</li>
      <li><strong>æ¨ç† QPS</strong>: 50K (å³°å€¼ 100K)</li>
      <li><strong>è¯»å–å»¶è¿Ÿè¦æ±‚</strong>: p99 < 10ms</li>
      <li><strong>Batch æ›´æ–°é¢‘ç‡</strong>: æ¯å°æ—¶ (å¤§éƒ¨åˆ†ç‰¹å¾), å®æ—¶ (ç‚¹å‡»/æµè§ˆç±»)</li>
      <li><strong>Offline Store å¤§å°</strong>: 10M Ã— 2KB Ã— 365 days â‰ˆ <strong>7TB/year</strong></li>
    </ul>
    <p><strong>æœˆæˆæœ¬ä¼°ç®—</strong>:</p>
    <ul>
      <li>Redis (Online): ~$200/mo (r6g.xlarge)</li>
      <li>S3 (Offline): ~$160/mo (7TB)</li>
      <li>Spark (Batch): ~$500/mo (å®šæ—¶é›†ç¾¤)</li>
      <li>Flink (Streaming): ~$800/mo (å¸¸é©»)</li>
      <li><strong>æ€»è®¡: ~$1,700/mo</strong></li>
    </ul>
  </div>

  <h2>ğŸ”— ä¸ Day 1 ä¸ƒå¤§ Pattern çš„æ˜ å°„</h2>

  <table>
    <tr>
      <th>Day 1 Pattern</th>
      <th>åœ¨ Feature Store ä¸­çš„ä½“ç°</th>
    </tr>
    <tr>
      <td>Multi-Stage Pipeline</td>
      <td>Raw Data â†’ Transform â†’ Feature View â†’ Online/Offline Store â†’ Serving</td>
    </tr>
    <tr>
      <td>Offline/Online Split</td>
      <td>Offline Store (è®­ç»ƒ) vs Online Store (æ¨ç†)ï¼ŒåŒä¸€ç‰¹å¾å®šä¹‰</td>
    </tr>
    <tr>
      <td>Multi-Layer Caching</td>
      <td>S3 (Cold) â†’ Redis (Hot) â†’ In-Memory (Feature Server cache)</td>
    </tr>
    <tr>
      <td>Guardrails & Verification</td>
      <td>Feature Registry åš schema validation, data quality monitoring</td>
    </tr>
    <tr>
      <td>Model Routing</td>
      <td>ä¸åŒæ¨¡å‹å¯ä»¥ä»åŒä¸€ Feature Store æŒ‰éœ€å–ä¸åŒç‰¹å¾å­é›†</td>
    </tr>
  </table>

  <h2>ğŸ“š å¯å­¦ä¹ çš„æ¨¡å¼ / Patterns to Learn</h2>

  <div class="highlight-green">
    <h4>Pattern 1: Define Once, Serve Everywhere</h4>
    <p>ç‰¹å¾é€»è¾‘å†™ä¸€æ¬¡ï¼Œè‡ªåŠ¨ç‰©åŒ–åˆ°ç¦»çº¿+åœ¨çº¿å­˜å‚¨ã€‚è¿™æ˜¯è§£å†³ Training-Serving Skew çš„æ ¹æœ¬ã€‚</p>
    <p><strong>åº”ç”¨åœºæ™¯</strong>: ä½ çš„ OpenClaw skill é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼æ¨¡å¼ â€” å®šä¹‰ä¸€æ¬¡ï¼Œå¤šå¤„å¼•ç”¨ã€‚</p>
  </div>

  <div class="highlight-green">
    <h4>Pattern 2: Point-in-Time Correctness</h4>
    <p>ä»»ä½•æ¶‰åŠæ—¶åºæ•°æ®çš„ç³»ç»Ÿï¼Œéƒ½è¦è€ƒè™‘"æ—¶é—´ç‚¹æ­£ç¡®æ€§"ã€‚ä¸åªæ˜¯ MLï¼Œå®¡è®¡æ—¥å¿—ã€äº‹ä»¶æº¯æºéƒ½éœ€è¦ã€‚</p>
  </div>

  <div class="highlight-green">
    <h4>Pattern 3: Registry as Single Source of Truth</h4>
    <p>Feature Registry å°±åƒ Schema Registry for Kafka â€” ä¸­å¤®åŒ–å…ƒæ•°æ®ç®¡ç†ï¼Œé˜²æ­¢ç‰¹å¾å®šä¹‰æ¼‚ç§»ã€‚</p>
  </div>

  <div class="highlight-green">
    <h4>Pattern 4: Batch + Streaming + On-Demand ä¸‰è½¨å¹¶è¡Œ</h4>
    <p>ä¸åŒç‰¹å¾æœ‰ä¸åŒæ–°é²œåº¦è¦æ±‚ã€‚ä¸è¦ä¸€åˆ€åˆ‡ï¼Œæ ¹æ®ä¸šåŠ¡ SLA é€‰æ‹©åˆé€‚çš„è®¡ç®—æ¨¡å¼ã€‚</p>
  </div>

  <h2>ğŸ¤ é¢è¯•é«˜é¢‘é—®é¢˜</h2>

  <div class="interview">
    <h4>Q1: ä»€ä¹ˆæ˜¯ Training-Serving Skewï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h4>
    <p><strong>ç­”</strong>: è®­ç»ƒå’Œæ¨ç†ä½¿ç”¨ä¸åŒçš„ç‰¹å¾è®¡ç®—é€»è¾‘å¯¼è‡´çš„ä¸ä¸€è‡´ã€‚è§£å†³æ–¹æ¡ˆï¼šFeature Store ç»Ÿä¸€ç‰¹å¾å®šä¹‰ï¼Œç¡®ä¿ Offline å’Œ Online è¯»å–çš„æ˜¯åŒä¸€ä¸ª transformation çš„äº§ç‰©ã€‚</p>
  </div>

  <div class="interview">
    <h4>Q2: è§£é‡Š Point-in-Time Joinï¼Œä¸ºä»€ä¹ˆå®ƒå¯¹ ML è®­ç»ƒè‡³å…³é‡è¦ï¼Ÿ</h4>
    <p><strong>ç­”</strong>: Point-in-Time Join ç¡®ä¿è®­ç»ƒæ ·æœ¬åªèƒ½çœ‹åˆ°äº‹ä»¶å‘ç”Ÿæ—¶åˆ»ä¹‹å‰çš„ç‰¹å¾å€¼ï¼Œé˜²æ­¢ Data Leakageã€‚å®ç°ä¸Šæ˜¯å¯¹ç‰¹å¾æ—¶é—´åºåˆ—åš AS OF JOIN â€” å¯¹æ¯æ¡è®­ç»ƒè®°å½•ï¼Œæ‰¾åˆ° â‰¤ event_timestamp çš„æœ€æ–°ç‰¹å¾ç‰ˆæœ¬ã€‚æ²¡æœ‰å®ƒï¼Œæ¨¡å‹ä¼šçœ‹åˆ°"æœªæ¥ä¿¡æ¯"ï¼Œè®­ç»ƒæŒ‡æ ‡è™šé«˜ä½†ä¸Šçº¿æ•ˆæœå·®ã€‚</p>
  </div>

  <div class="interview">
    <h4>Q3: Feast vs Tecton å¦‚ä½•é€‰å‹ï¼Ÿ</h4>
    <p><strong>ç­”</strong>: Feast é€‚åˆå·²æœ‰ data infra çš„å›¢é˜Ÿï¼Œè½»é‡å¼€æºï¼Œä½†å®æ—¶ç‰¹å¾èƒ½åŠ›æœ‰é™ã€‚Tecton æ˜¯æ‰˜ç®¡æ–¹æ¡ˆï¼Œå†…å»ºå®æ—¶ç‰¹å¾ pipeline å’Œè°ƒåº¦ï¼Œé€‚åˆéœ€è¦äºšç§’çº§ç‰¹å¾çš„åœºæ™¯ï¼ˆå¦‚å®æ—¶æ¨èã€æ¬ºè¯ˆæ£€æµ‹ï¼‰ï¼Œä½†æˆæœ¬é«˜ã€‚å…³é”®å†³ç­–å› ç´ ï¼šå®æ—¶éœ€æ±‚å¼ºåº¦ã€å›¢é˜Ÿ data eng èƒ½åŠ›ã€é¢„ç®—ã€‚</p>
  </div>

  <div class="interview">
    <h4>Q4: å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ”¯æŒ 10ä¸‡ QPS çš„ Feature Serving å±‚ï¼Ÿ</h4>
    <p><strong>ç­”</strong>: (1) åœ¨çº¿å­˜å‚¨ç”¨ Redis Cluster åˆ†ç‰‡ (2) Feature Server åš batch lookup â€” ä¸€æ¬¡è¯·æ±‚èšåˆå¤šä¸ªç‰¹å¾çš„è¯»å– (3) çƒ­é—¨å®ä½“åšæœ¬åœ°ç¼“å­˜ (TTL < ç‰©åŒ–é¢‘ç‡) (4) é¢„è®¡ç®—ç‰¹å¾å‘é‡è€Œéè¿è¡Œæ—¶æ‹¼æ¥ (5) é™çº§ç­–ç•¥ â€” åœ¨çº¿ä¸å¯ç”¨æ—¶ç”¨é»˜è®¤å€¼ï¼Œä¸é˜»å¡æ¨ç†ã€‚</p>
  </div>

  <h2>ğŸ’¡ æ€è€ƒé¢˜</h2>
  <div class="follow-up">
    <p>åœ¨ LLM æ—¶ä»£ï¼Œä¼ ç»Ÿ Feature Store çš„ä»·å€¼æ˜¯å¦åœ¨ä¸‹é™ï¼ŸRAG ç³»ç»Ÿä¸­çš„ Vector Store + Embedding æ˜¯å¦å¯ä»¥è¢«çœ‹ä½œä¸€ç§"è¯­ä¹‰ Feature Store"ï¼Ÿå¦‚æœä½ è¦ä¸ºä¸€ä¸ª LLM-native æ¨èç³»ç»Ÿè®¾è®¡ç‰¹å¾ç®¡ç†æ–¹æ¡ˆï¼Œä½ ä¼šæ€æ ·ç»“åˆä¼ ç»Ÿ Feature Store å’Œ Vector DBï¼Ÿ</p>
  </div>

</body>
</html>
