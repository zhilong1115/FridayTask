<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>2026-02-20 â€” æ—¶é—´åºåˆ—åŸºç¡€ï¼šå¹³ç¨³æ€§ã€è‡ªç›¸å…³ã€ADF æ£€éªŒ</title>
  <style>
    body { font-family: -apple-system, system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.8; color: #333; }
    .bilingual { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .zh { border-left: 3px solid #c41e3a; padding-left: 15px; }
    .en { border-left: 3px solid #1a73e8; padding-left: 15px; }
    h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
    h2 { color: #2980b9; margin-top: 30px; }
    h3 { color: #34495e; }
    .formula { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: 'Courier New', monospace; overflow-x: auto; }
    pre.code { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 14px; line-height: 1.5; }
    .insight { background: #eaf2f8; padding: 15px; border-radius: 8px; margin: 20px 0; }
    .references { background: #f8f9fa; padding: 15px; border-radius: 8px; }
    .warning { background: #fdecea; padding: 15px; border-radius: 8px; border-left: 4px solid #e74c3c; margin: 15px 0; }
    .key-concept { background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50; margin: 15px 0; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f2f2f2; }
    .tag { display: inline-block; background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 13px; margin: 2px; }
  </style>
</head>
<body>

<h1>ğŸ“ˆ Day 5 â€” æ—¶é—´åºåˆ—åŸºç¡€ï¼šå¹³ç¨³æ€§ã€è‡ªç›¸å…³ã€ADF æ£€éªŒ</h1>
<p><strong>Time Series Fundamentals: Stationarity, Autocorrelation & the ADF Test</strong></p>
<p>2026-02-20 | Phase 1: Foundations | <span class="tag">æ—¶é—´åºåˆ—</span> <span class="tag">å¹³ç¨³æ€§</span> <span class="tag">ADF</span> <span class="tag">è‡ªç›¸å…³</span></p>

<hr>

<div class="bilingual">
<div class="zh">
<h2>ä¸€ã€ä¸ºä»€ä¹ˆé‡åŒ–äº¤æ˜“å¿…é¡»ç†è§£æ—¶é—´åºåˆ—ï¼Ÿ</h2>
<p>é‡åŒ–äº¤æ˜“çš„æ ¸å¿ƒå‡è®¾ï¼š<strong>å†å²æ¨¡å¼ä¼šåœ¨æœªæ¥é‡å¤</strong>ã€‚ä½†è¿™ä¸ªå‡è®¾åªåœ¨æ•°æ®å…·æœ‰æŸç§"ç¨³å®šæ€§"æ—¶æ‰æˆç«‹ã€‚å¦‚æœä¸€ä¸ªæ—¶é—´åºåˆ—çš„ç»Ÿè®¡ç‰¹å¾ï¼ˆå‡å€¼ã€æ–¹å·®ï¼‰ä¸æ–­å˜åŒ–ï¼Œé‚£ä¹ˆä½ åœ¨å†å²æ•°æ®ä¸Šå‘ç°çš„ä»»ä½•è§„å¾‹éƒ½å¯èƒ½æ˜¯æµ·å¸‚èœƒæ¥¼ã€‚</p>
<p>è¿™å°±æ˜¯<strong>å¹³ç¨³æ€§ï¼ˆStationarityï¼‰</strong>å¦‚æ­¤é‡è¦çš„åŸå› â€”â€”å®ƒæ˜¯å‡ ä¹æ‰€æœ‰é‡åŒ–æ¨¡å‹çš„å‰ç½®æ¡ä»¶ã€‚</p>
</div>
<div class="en">
<h2>I. Why Must Quant Traders Understand Time Series?</h2>
<p>The core assumption in quant trading: <strong>historical patterns repeat</strong>. But this only holds when data has some form of "stability." If a time series' statistical properties (mean, variance) keep shifting, any pattern you find in historical data may be a mirage.</p>
<p>That's why <strong>stationarity</strong> matters so muchâ€”it's a prerequisite for nearly every quantitative model.</p>
</div>
</div>

<h2>äºŒã€å¹³ç¨³æ€§çš„ä¸‰ä¸ªå±‚æ¬¡ / Three Levels of Stationarity</h2>

<div class="bilingual">
<div class="zh">
<h3>1. ä¸¥æ ¼å¹³ç¨³ï¼ˆStrict Stationarityï¼‰</h3>
<p>è”åˆåˆ†å¸ƒä¸éšæ—¶é—´å¹³ç§»è€Œæ”¹å˜ã€‚æ•°å­¦ä¸Šå¾ˆç¾ä½†å®é™…ä¸­å‡ ä¹æ— æ³•éªŒè¯ã€‚</p>

<h3>2. å¼±å¹³ç¨³ / åæ–¹å·®å¹³ç¨³ï¼ˆWeak/Covariance Stationarityï¼‰</h3>
<p><strong>è¿™æ˜¯é‡åŒ–ä¸­æœ€å¸¸ç”¨çš„å®šä¹‰ï¼š</strong></p>
<ul>
<li>å‡å€¼ E[Yâ‚œ] = Î¼ï¼ˆå¸¸æ•°ï¼Œä¸éš t å˜åŒ–ï¼‰</li>
<li>æ–¹å·® Var(Yâ‚œ) = ÏƒÂ²ï¼ˆå¸¸æ•°ï¼‰</li>
<li>è‡ªåæ–¹å·® Cov(Yâ‚œ, Yâ‚œâ‚Šâ‚–) = Î³(k)ï¼ˆåªä¾èµ–äºæ»åæœŸ kï¼Œä¸ä¾èµ–äº tï¼‰</li>
</ul>

<h3>3. è¶‹åŠ¿å¹³ç¨³ vs å·®åˆ†å¹³ç¨³</h3>
<p><strong>è¶‹åŠ¿å¹³ç¨³</strong>ï¼šå»æ‰ç¡®å®šæ€§è¶‹åŠ¿åå¹³ç¨³ï¼ˆYâ‚œ = Î± + Î²t + Îµâ‚œï¼‰</p>
<p><strong>å·®åˆ†å¹³ç¨³</strong>ï¼šéœ€è¦å·®åˆ†æ‰èƒ½å˜å¹³ç¨³ï¼ˆå¤§å¤šæ•°é‡‘èæ—¶é—´åºåˆ—å±äºæ­¤ç±»ï¼‰</p>
</div>
<div class="en">
<h3>1. Strict Stationarity</h3>
<p>Joint distribution is invariant under time shifts. Mathematically elegant but nearly impossible to verify.</p>

<h3>2. Weak/Covariance Stationarity</h3>
<p><strong>The definition most used in quant:</strong></p>
<ul>
<li>Mean E[Yâ‚œ] = Î¼ (constant)</li>
<li>Variance Var(Yâ‚œ) = ÏƒÂ² (constant)</li>
<li>Autocovariance Cov(Yâ‚œ, Yâ‚œâ‚Šâ‚–) = Î³(k) (depends only on lag k)</li>
</ul>

<h3>3. Trend-Stationary vs Difference-Stationary</h3>
<p><strong>Trend-stationary</strong>: Stationary after removing deterministic trend</p>
<p><strong>Difference-stationary</strong>: Requires differencing (most financial series)</p>
</div>
</div>

<div class="key-concept">
<strong>ğŸ”‘ å…³é”®ç›´è§‰ / Key Intuitionï¼š</strong> è‚¡ç¥¨<strong>ä»·æ ¼</strong>å‡ ä¹æ€»æ˜¯éå¹³ç¨³çš„ï¼ˆéšæœºæ¸¸èµ°ï¼‰ï¼Œä½†<strong>æ”¶ç›Šç‡</strong>é€šå¸¸æ˜¯å¹³ç¨³çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Day 3 æˆ‘ä»¬å¼ºè°ƒè¦ç”¨ returns è€Œé prices åšåˆ†æã€‚
</div>

<h2>ä¸‰ã€éšæœºæ¸¸èµ°ä¸å•ä½æ ¹ / Random Walk & Unit Root</h2>

<div class="formula">
<strong>éšæœºæ¸¸èµ°æ¨¡å‹ / Random Walk:</strong><br>
Yâ‚œ = Yâ‚œâ‚‹â‚ + Îµâ‚œ , where Îµâ‚œ ~ WN(0, ÏƒÂ²)<br><br>
ç­‰ä»·å†™æ³• / Equivalent: Yâ‚œ = Yâ‚€ + Î£áµ¢â‚Œâ‚áµ— Îµáµ¢<br><br>
<strong>æ€§è´¨ / Properties:</strong><br>
E[Yâ‚œ] = Yâ‚€ (å¸¸æ•° âœ“)<br>
Var(Yâ‚œ) = tÂ·ÏƒÂ² (éš t å¢é•¿ âœ— â€” éå¹³ç¨³!)<br><br>
<strong>å¸¦æ¼‚ç§»çš„éšæœºæ¸¸èµ° / Random Walk with Drift:</strong><br>
Yâ‚œ = Î¼ + Yâ‚œâ‚‹â‚ + Îµâ‚œ<br>
E[Yâ‚œ] = Yâ‚€ + Î¼t (å‡å€¼ä¹Ÿä¸æ’å®šäº†)
</div>

<div class="bilingual">
<div class="zh">
<h3>å•ä½æ ¹é—®é¢˜</h3>
<p>è€ƒè™‘ AR(1) æ¨¡å‹ï¼šYâ‚œ = Ï†Yâ‚œâ‚‹â‚ + Îµâ‚œ</p>
<ul>
<li>|Ï†| &lt; 1ï¼šå¹³ç¨³ï¼Œå‡å€¼å›å½’ â†’ å¯ä»¥åš mean reversion ç­–ç•¥</li>
<li>Ï† = 1ï¼šå•ä½æ ¹ï¼Œéšæœºæ¸¸èµ° â†’ <strong>ä¸å¹³ç¨³</strong></li>
<li>|Ï†| > 1ï¼šçˆ†ç‚¸è¿‡ç¨‹ â†’ ç°å®ä¸­ç½•è§</li>
</ul>
<p><strong>æ£€æµ‹æ˜¯å¦å­˜åœ¨å•ä½æ ¹ï¼Œå°±æ˜¯æ£€æµ‹å¹³ç¨³æ€§çš„å…³é”®ã€‚</strong></p>
</div>
<div class="en">
<h3>The Unit Root Problem</h3>
<p>Consider AR(1): Yâ‚œ = Ï†Yâ‚œâ‚‹â‚ + Îµâ‚œ</p>
<ul>
<li>|Ï†| &lt; 1: Stationary, mean-reverting â†’ can trade mean reversion</li>
<li>Ï† = 1: Unit root, random walk â†’ <strong>non-stationary</strong></li>
<li>|Ï†| > 1: Explosive â†’ rare in practice</li>
</ul>
<p><strong>Testing for a unit root is the key to testing stationarity.</strong></p>
</div>
</div>

<h2>å››ã€è‡ªç›¸å…³å‡½æ•° ACF & PACF / Autocorrelation</h2>

<div class="formula">
<strong>è‡ªç›¸å…³å‡½æ•° (ACF) / Autocorrelation Function:</strong><br>
Ï(k) = Cov(Yâ‚œ, Yâ‚œâ‚Šâ‚–) / Var(Yâ‚œ) = Î³(k) / Î³(0)<br><br>

<strong>åè‡ªç›¸å…³å‡½æ•° (PACF) / Partial Autocorrelation Function:</strong><br>
Ï†â‚–â‚– = Corr(Yâ‚œ, Yâ‚œâ‚Šâ‚– | Yâ‚œâ‚Šâ‚, ..., Yâ‚œâ‚Šâ‚–â‚‹â‚)<br>
ï¼ˆæ§åˆ¶ä¸­é—´å˜é‡åçš„"çº¯"ç›¸å…³æ€§ / "pure" correlation after controlling intermediate variablesï¼‰
</div>

<div class="bilingual">
<div class="zh">
<h3>ACF/PACF çš„é‡åŒ–äº¤æ˜“å«ä¹‰</h3>
<table>
<tr><th>æ¨¡å¼</th><th>ACF ç‰¹å¾</th><th>PACF ç‰¹å¾</th><th>äº¤æ˜“å«ä¹‰</th></tr>
<tr><td>ç™½å™ªå£°</td><td>å…¨éƒ¨åœ¨ç½®ä¿¡åŒºé—´å†…</td><td>å…¨éƒ¨åœ¨ç½®ä¿¡åŒºé—´å†…</td><td>æ— å¯é¢„æµ‹æ€§ â†’ ä¸è¦äº¤æ˜“</td></tr>
<tr><td>AR(p) è¿‡ç¨‹</td><td>æŒ‡æ•°è¡°å‡æˆ–æŒ¯è¡è¡°å‡</td><td>p é˜¶åæˆªæ–­</td><td>çŸ­æœŸå‡å€¼å›å½’æˆ–åŠ¨é‡</td></tr>
<tr><td>MA(q) è¿‡ç¨‹</td><td>q é˜¶åæˆªæ–­</td><td>è¡°å‡</td><td>å†²å‡»æœ‰é™æŒç»­ â†’ äº‹ä»¶é©±åŠ¨</td></tr>
<tr><td>éšæœºæ¸¸èµ°</td><td>ç¼“æ…¢çº¿æ€§è¡°å‡</td><td>ä¸€é˜¶æ˜¾è‘—</td><td>éå¹³ç¨³ â†’ éœ€è¦å·®åˆ†</td></tr>
</table>
</div>
<div class="en">
<h3>ACF/PACF Trading Implications</h3>
<table>
<tr><th>Pattern</th><th>ACF</th><th>PACF</th><th>Trading Implication</th></tr>
<tr><td>White Noise</td><td>All within CI</td><td>All within CI</td><td>Unpredictable â†’ don't trade</td></tr>
<tr><td>AR(p)</td><td>Exponential/oscillating decay</td><td>Cuts off after p</td><td>Short-term mean reversion or momentum</td></tr>
<tr><td>MA(q)</td><td>Cuts off after q</td><td>Decays</td><td>Limited shock duration â†’ event-driven</td></tr>
<tr><td>Random Walk</td><td>Slow linear decay</td><td>Significant at lag 1</td><td>Non-stationary â†’ difference first</td></tr>
</table>
</div>
</div>

<div class="warning">
<strong>âš ï¸ å¸¸è§é”™è¯¯ / Common Mistakeï¼š</strong>å¯¹éå¹³ç¨³åºåˆ—è®¡ç®— ACF ä¼šå¾—åˆ°"è™šå‡ç›¸å…³"ã€‚ACF ç¼“æ…¢è¡°å‡ä¸ä»£è¡¨"é•¿è®°å¿†"ï¼Œå¯èƒ½åªæ˜¯åºåˆ—ä¸å¹³ç¨³ã€‚<strong>æ°¸è¿œå…ˆæ£€éªŒå¹³ç¨³æ€§ï¼</strong>
</div>

<h2>äº”ã€ADF æ£€éªŒè¯¦è§£ / The Augmented Dickey-Fuller Test</h2>

<div class="bilingual">
<div class="zh">
<h3>ä» DF åˆ° ADF</h3>
<p>åŸå§‹ Dickey-Fuller æ£€éªŒåŸºäºï¼š</p>
<p style="font-family: monospace;">Î”Yâ‚œ = (Ï†-1)Yâ‚œâ‚‹â‚ + Îµâ‚œ = Î´Yâ‚œâ‚‹â‚ + Îµâ‚œ</p>
<p>Hâ‚€: Î´ = 0 (å­˜åœ¨å•ä½æ ¹ï¼Œéå¹³ç¨³)<br>
Hâ‚: Î´ &lt; 0 (å¹³ç¨³)</p>
<p>é—®é¢˜ï¼šåŸå§‹ DF å‡è®¾è¯¯å·®é¡¹æ˜¯ç™½å™ªå£°ï¼Œä½†ç°å®ä¸­è¯¯å·®å¯èƒ½è‡ªç›¸å…³ã€‚<strong>ADF é€šè¿‡æ·»åŠ æ»åå·®åˆ†é¡¹æ¥è§£å†³</strong>ï¼š</p>
</div>
<div class="en">
<h3>From DF to ADF</h3>
<p>Original Dickey-Fuller test is based on:</p>
<p style="font-family: monospace;">Î”Yâ‚œ = Î´Yâ‚œâ‚‹â‚ + Îµâ‚œ</p>
<p>Hâ‚€: Î´ = 0 (unit root, non-stationary)<br>
Hâ‚: Î´ &lt; 0 (stationary)</p>
<p>Problem: Original DF assumes white noise errors. Reality has autocorrelated errors. <strong>ADF fixes this by adding lagged differences</strong>:</p>
</div>
</div>

<div class="formula">
<strong>ADF å›å½’æ–¹ç¨‹ / ADF Regression:</strong><br><br>
Î”Yâ‚œ = Î± + Î²t + Î´Yâ‚œâ‚‹â‚ + Î£áµ¢â‚Œâ‚áµ– Î³áµ¢Î”Yâ‚œâ‚‹áµ¢ + Îµâ‚œ<br><br>
å…¶ä¸­ / where:<br>
- Î± = æˆªè·/å¸¸æ•°é¡¹ (intercept/drift)<br>
- Î²t = æ—¶é—´è¶‹åŠ¿é¡¹ (time trend, optional)<br>
- Î´Yâ‚œâ‚‹â‚ = å•ä½æ ¹æ£€éªŒé¡¹ (unit root test term)<br>
- Î£ Î³áµ¢Î”Yâ‚œâ‚‹áµ¢ = æ»åå·®åˆ†é¡¹ï¼Œæ¶ˆé™¤æ®‹å·®è‡ªç›¸å…³ (lagged differences to remove autocorrelation)<br>
- p = æ»åé˜¶æ•° (lag order, typically chosen by AIC/BIC)<br><br>

<strong>æ£€éªŒç»Ÿè®¡é‡ / Test Statistic:</strong><br>
ADF stat = Î´Ì‚ / SE(Î´Ì‚)<br>
æ³¨æ„ï¼šä¸æœä»æ ‡å‡† t åˆ†å¸ƒï¼ä½¿ç”¨ Dickey-Fuller ä¸´ç•Œå€¼è¡¨<br>
(Does NOT follow standard t-distribution! Uses DF critical value tables)
</div>

<div class="key-concept">
<strong>ğŸ”‘ ä¸‰ç§ ADF æ¨¡å‹è§„æ ¼ / Three ADF Specifications:</strong><br><br>
1. <strong>æ— å¸¸æ•°æ— è¶‹åŠ¿</strong> (None): Î”Yâ‚œ = Î´Yâ‚œâ‚‹â‚ + Î£ Î³áµ¢Î”Yâ‚œâ‚‹áµ¢ + Îµâ‚œ<br>
2. <strong>æœ‰å¸¸æ•°æ— è¶‹åŠ¿</strong> (Constant): Î”Yâ‚œ = Î± + Î´Yâ‚œâ‚‹â‚ + Î£ Î³áµ¢Î”Yâ‚œâ‚‹áµ¢ + Îµâ‚œ â€” <strong>æœ€å¸¸ç”¨</strong><br>
3. <strong>æœ‰å¸¸æ•°æœ‰è¶‹åŠ¿</strong> (Constant + Trend): Î”Yâ‚œ = Î± + Î²t + Î´Yâ‚œâ‚‹â‚ + Î£ Î³áµ¢Î”Yâ‚œâ‚‹áµ¢ + Îµâ‚œ<br><br>
é‡‘èæ•°æ®é€šå¸¸ç”¨ç¬¬ 2 ç§ã€‚å¦‚æœä½ æ€€ç–‘æœ‰ç¡®å®šæ€§è¶‹åŠ¿ï¼ˆå¦‚ GDPï¼‰ï¼Œç”¨ç¬¬ 3 ç§ã€‚
</div>

<h2>å…­ã€Python å®æˆ˜ / Python Implementation</h2>

<pre class="code">
import numpy as np
import pandas as pd
import yfinance as yf
import matplotlib.pyplot as plt
from statsmodels.tsa.stattools import adfuller, acf, pacf
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf

# ============================================
# 1. è·å–æ•°æ® / Fetch Data
# ============================================
spy = yf.download('SPY', start='2020-01-01', end='2026-02-01')
prices = spy['Close']
returns = prices.pct_change().dropna()
log_returns = np.log(prices / prices.shift(1)).dropna()

# ============================================
# 2. ADF æ£€éªŒå‡½æ•° / ADF Test Function
# ============================================
def run_adf_test(series, name="Series"):
    """è¿è¡Œ ADF æ£€éªŒå¹¶æ‰“å°è¯¦ç»†ç»“æœ"""
    result = adfuller(series.dropna(), autolag='AIC')
    
    print(f"\n{'='*50}")
    print(f"ADF Test for: {name}")
    print(f"{'='*50}")
    print(f"ADF Statistic:  {result[0]:.6f}")
    print(f"p-value:        {result[1]:.6f}")
    print(f"Lags Used:      {result[2]}")
    print(f"Observations:   {result[3]}")
    print(f"Critical Values:")
    for key, val in result[4].items():
        marker = " â† REJECT Hâ‚€" if result[0] < val else ""
        print(f"  {key}: {val:.4f}{marker}")
    
    if result[1] < 0.05:
        print(f"\nâœ… ç»“è®º: {name} æ˜¯å¹³ç¨³çš„ (p={result[1]:.4f} < 0.05)")
    else:
        print(f"\nâŒ ç»“è®º: {name} æ˜¯éå¹³ç¨³çš„ (p={result[1]:.4f} >= 0.05)")
    
    return result

# ============================================
# 3. å¯¹ä»·æ ¼å’Œæ”¶ç›Šç‡åˆ†åˆ«æ£€éªŒ
# ============================================
price_result = run_adf_test(prices, "SPY Prices")
# å…¸å‹è¾“å‡º: ADF stat â‰ˆ -1.2, p â‰ˆ 0.65 â†’ éå¹³ç¨³

return_result = run_adf_test(returns, "SPY Returns")
# å…¸å‹è¾“å‡º: ADF stat â‰ˆ -15.3, p â‰ˆ 0.00 â†’ å¹³ç¨³ï¼

log_return_result = run_adf_test(log_returns, "SPY Log Returns")
# åŒæ ·å¹³ç¨³

# ============================================
# 4. ACF/PACF å¯è§†åŒ– / Visualization
# ============================================
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ä»·æ ¼çš„ ACF â€” ç¼“æ…¢è¡°å‡ = éå¹³ç¨³ä¿¡å·
plot_acf(prices.dropna(), lags=40, ax=axes[0, 0], title='ACF: SPY Prices (Non-Stationary)')

# æ”¶ç›Šç‡çš„ ACF â€” å¿«é€Ÿè¡°å‡ = å¹³ç¨³ä¿¡å·  
plot_acf(returns.dropna(), lags=40, ax=axes[0, 1], title='ACF: SPY Returns (Stationary)')

# æ”¶ç›Šç‡çš„ PACF
plot_pacf(returns.dropna(), lags=40, ax=axes[1, 0], title='PACF: SPY Returns')

# æ”¶ç›Šç‡å¹³æ–¹çš„ ACF â€” æ³¢åŠ¨ç‡èšé›†!
plot_acf(returns.dropna()**2, lags=40, ax=axes[1, 1], 
         title='ACF: SPY ReturnsÂ² (Volatility Clustering)')

plt.tight_layout()
plt.savefig('acf_pacf_analysis.png', dpi=150)
plt.show()

# ============================================
# 5. å®é™…åº”ç”¨ï¼šé…å¯¹äº¤æ˜“å¹³ç¨³æ€§æ£€éªŒ
#    Pairs Trading: Test Spread Stationarity
# ============================================
# ä¸‹è½½ä¸¤åªé«˜åº¦ç›¸å…³çš„è‚¡ç¥¨
data = yf.download(['KO', 'PEP'], start='2020-01-01', end='2026-02-01')
ko = data['Close']['KO']
pep = data['Close']['PEP']

# ç®€å•ä»·å·® â€” é€šå¸¸ä¸å¹³ç¨³
simple_spread = ko - pep
run_adf_test(simple_spread, "KO - PEP Simple Spread")

# OLS å¯¹å†²æ¯”ç‡ â†’ åæ•´ä»·å·®
from sklearn.linear_model import LinearRegression
model = LinearRegression()
model.fit(pep.values.reshape(-1, 1), ko.values)
hedge_ratio = model.coef_[0]
print(f"\nHedge Ratio (Î²): {hedge_ratio:.4f}")

# åæ•´ä»·å·®
coint_spread = ko - hedge_ratio * pep
run_adf_test(coint_spread, f"KO - {hedge_ratio:.3f}*PEP Cointegrated Spread")
# å¦‚æœå¹³ç¨³ â†’ å¯ä»¥åšé…å¯¹äº¤æ˜“ï¼

# ============================================
# 6. KPSS æ£€éªŒï¼ˆäº’è¡¥ï¼‰/ KPSS Test
# ============================================
from statsmodels.tsa.stattools import kpss

def run_kpss_test(series, name="Series"):
    """KPSS ä¸ ADF äº’è¡¥ï¼šHâ‚€ æ˜¯å¹³ç¨³ï¼ˆç›¸åï¼ï¼‰"""
    stat, p, lags, crit = kpss(series.dropna(), regression='c', nlags='auto')
    print(f"\nKPSS Test for: {name}")
    print(f"KPSS Stat: {stat:.4f}, p-value: {p:.4f}")
    if p > 0.05:
        print(f"âœ… ä¸èƒ½æ‹’ç»å¹³ç¨³æ€§å‡è®¾")
    else:
        print(f"âŒ æ‹’ç»å¹³ç¨³æ€§å‡è®¾ â†’ éå¹³ç¨³")

# ADF + KPSS è”åˆåˆ¤æ–­ï¼ˆæœ€ä½³å®è·µï¼‰
# ADF å¹³ç¨³ + KPSS å¹³ç¨³ â†’ ç¡®è®¤å¹³ç¨³ âœ…
# ADF éå¹³ç¨³ + KPSS éå¹³ç¨³ â†’ ç¡®è®¤éå¹³ç¨³ âŒ
# ä¸¤è€…çŸ›ç›¾ â†’ éœ€è¦æ›´å¤šåˆ†æ âš ï¸
run_kpss_test(returns, "SPY Returns")
run_kpss_test(prices, "SPY Prices")
</pre>

<h2>ä¸ƒã€é‡åŒ–äº¤æ˜“ä¸­çš„å®é™…åº”ç”¨ / Practical Applications</h2>

<div class="bilingual">
<div class="zh">
<h3>åº”ç”¨ 1ï¼šé…å¯¹äº¤æ˜“å‰ç½®æ£€éªŒ</h3>
<p>åœ¨åš Pairs Tradingï¼ˆDay 16 ä¼šè¯¦ç»†è®²ï¼‰ä¹‹å‰ï¼Œ<strong>å¿…é¡»</strong>å…ˆç”¨ ADF æ£€éªŒç¡®è®¤ä»·å·®åºåˆ—çš„å¹³ç¨³æ€§ã€‚å¦‚æœä»·å·®ä¸å¹³ç¨³ï¼Œå‡å€¼å›å½’ç­–ç•¥å°†å¤±è´¥ã€‚</p>

<h3>åº”ç”¨ 2ï¼šç‰¹å¾å·¥ç¨‹</h3>
<p>å–‚ç»™ ML æ¨¡å‹çš„ç‰¹å¾<strong>å¿…é¡»æ˜¯å¹³ç¨³çš„</strong>ã€‚å¸¸è§è½¬æ¢ï¼š</p>
<ul>
<li>ä»·æ ¼ â†’ æ”¶ç›Šç‡ï¼ˆä¸€é˜¶å·®åˆ†ï¼‰</li>
<li>æˆäº¤é‡ â†’ æˆäº¤é‡å˜åŒ–ç‡</li>
<li>æ³¢åŠ¨ç‡ â†’ æ³¢åŠ¨ç‡æ¯”ç‡ï¼ˆå½“å‰/å†å²ï¼‰</li>
<li>å¸‚ç›ˆç‡ â†’ z-score æ ‡å‡†åŒ–</li>
</ul>

<h3>åº”ç”¨ 3ï¼šç­–ç•¥ä¿¡å·éªŒè¯</h3>
<p>å¦‚æœä½ çš„ alpha ä¿¡å·æ˜¯éå¹³ç¨³çš„ï¼Œå®ƒå¯èƒ½æ•æ‰çš„æ˜¯è¶‹åŠ¿è€ŒéçœŸå® alphaã€‚å·®åˆ†æˆ–å»è¶‹åŠ¿åå†è¯„ä¼°ã€‚</p>

<h3>åº”ç”¨ 4ï¼šé£é™©æ¨¡å‹</h3>
<p>VaR å’Œæ³¢åŠ¨ç‡æ¨¡å‹éƒ½å‡è®¾æ”¶ç›Šç‡å¹³ç¨³ã€‚åœ¨å¸‚åœº regime change æœŸé—´ï¼ˆå¦‚ COVID crashï¼‰ï¼Œè¿™ä¸ªå‡è®¾è¢«æ‰“ç ´ï¼Œæ¨¡å‹ä¼šä¸¥é‡ä½ä¼°é£é™©ã€‚</p>
</div>
<div class="en">
<h3>App 1: Pairs Trading Pre-check</h3>
<p>Before Pairs Trading (covered in Day 16), you <strong>must</strong> confirm spread stationarity via ADF. Non-stationary spread = failed mean reversion strategy.</p>

<h3>App 2: Feature Engineering</h3>
<p>Features fed to ML models <strong>must be stationary</strong>. Common transforms:</p>
<ul>
<li>Price â†’ Returns (first difference)</li>
<li>Volume â†’ Volume change rate</li>
<li>Volatility â†’ Volatility ratio (current/historical)</li>
<li>P/E ratio â†’ z-score normalization</li>
</ul>

<h3>App 3: Signal Validation</h3>
<p>If your alpha signal is non-stationary, it might capture trend, not true alpha. Difference or detrend before evaluating.</p>

<h3>App 4: Risk Models</h3>
<p>VaR and volatility models assume stationary returns. During regime changes (e.g., COVID crash), this assumption breaks, and models severely underestimate risk.</p>
</div>
</div>

<div class="insight">
<strong>ğŸ’¡ è¿›é˜¶æ´å¯Ÿ / Advanced Insightï¼š</strong><br><br>
<strong>ADF vs KPSS è”åˆæ£€éªŒç­–ç•¥ï¼š</strong><br>
ADF çš„ Hâ‚€ æ˜¯"éå¹³ç¨³"ï¼ŒKPSS çš„ Hâ‚€ æ˜¯"å¹³ç¨³"ã€‚å•ç‹¬ä½¿ç”¨ä»»ä½•ä¸€ä¸ªéƒ½å¯èƒ½çŠ¯é”™ã€‚<br>
æœ€ä½³å®è·µæ˜¯ä¸¤è€…åŒæ—¶ä½¿ç”¨ï¼š<br><br>
â€¢ ADF reject + KPSS not reject â†’ <strong>ç¡®è®¤å¹³ç¨³</strong> âœ…<br>
â€¢ ADF not reject + KPSS reject â†’ <strong>ç¡®è®¤éå¹³ç¨³</strong> âŒ<br>
â€¢ ä¸¤è€…éƒ½ reject â†’ å¯èƒ½æ˜¯è¶‹åŠ¿å¹³ç¨³ âš ï¸<br>
â€¢ ä¸¤è€…éƒ½ä¸ reject â†’ éœ€è¦æ›´å¤šæ•°æ®æˆ–å…¶ä»–æ£€éªŒ âš ï¸<br><br>
å‚è€ƒ: Kwiatkowski, Phillips, Schmidt, Shin (1992)ï¼Œè¿™ä¹Ÿæ˜¯ Marcos LÃ³pez de Prado åœ¨ã€ŠAdvances in Financial Machine Learningã€‹ä¸­æ¨èçš„æ–¹æ³•ã€‚
</div>

<h2>å…«ã€ä¸å‰å‡ å¤©çš„çŸ¥è¯†ç½‘ç»œ / Knowledge Graph</h2>

<div class="key-concept">
<strong>çŸ¥è¯†è¿æ¥ / Connections:</strong><br><br>
ğŸ“Š <strong>Day 3 (æ”¶ç›Šç‡)</strong> â†’ ä»Šå¤©è§£é‡Šäº†<em>ä¸ºä»€ä¹ˆ</em>ç”¨æ”¶ç›Šç‡ï¼šå› ä¸ºæ”¶ç›Šç‡é€šå¸¸æ˜¯å¹³ç¨³çš„ï¼<br>
ğŸ“Š <strong>Day 4 (Fat Tails)</strong> â†’ å³ä½¿å¹³ç¨³çš„æ”¶ç›Šç‡åºåˆ—ä¹Ÿå¯èƒ½æœ‰ fat tailsï¼Œè¿™å½±å“ ADF æ£€éªŒçš„å¯é æ€§<br>
ğŸ“Š <strong>Day 2 (æ•°æ®æ¸…æ´—)</strong> â†’ æ•°æ®ä¸­çš„é”™è¯¯ï¼ˆå¦‚ç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ï¼‰ä¼šä¸¥é‡å½±å“å¹³ç¨³æ€§æ£€éªŒ<br>
ğŸ”® <strong>Day 6 (å›æµ‹æ¡†æ¶)</strong> â†’ éœ€è¦å¹³ç¨³æ€§æ£€éªŒæ¥éªŒè¯ç­–ç•¥å‡è®¾<br>
ğŸ”® <strong>Day 16 (Pairs Trading)</strong> â†’ ADF/åæ•´æ£€éªŒæ˜¯é…å¯¹äº¤æ˜“çš„æ ¸å¿ƒå·¥å…·<br>
ğŸ”® <strong>Day 33 (ç‰¹å¾å·¥ç¨‹)</strong> â†’ æ‰€æœ‰è¾“å…¥ ML çš„ç‰¹å¾éƒ½éœ€è¦å¹³ç¨³æ€§è½¬æ¢
</div>

<h2>ä¹ã€å‚è€ƒæ–‡çŒ® / References</h2>

<div class="references">
<ol>
<li>Hamilton, J.D. (1994). <em>Time Series Analysis</em>. Princeton University Press. â€” æ—¶é—´åºåˆ—åˆ†æçš„åœ£ç»</li>
<li>Tsay, R.S. (2010). <em>Analysis of Financial Time Series</em>, 3rd ed. Wiley. â€” é‡‘èæ—¶é—´åºåˆ—ä¸“è‘—</li>
<li>LÃ³pez de Prado, M. (2018). <em>Advances in Financial Machine Learning</em>. Wiley. â€” Ch. 5: Fractional Differentiation</li>
<li>Chan, E. (2013). <em>Algorithmic Trading</em>. Wiley. â€” Ch. 2: Mean Reversion & Stationarity Tests</li>
<li>Dickey, D.A. & Fuller, W.A. (1979). "Distribution of the Estimators for Autoregressive Time Series With a Unit Root." <em>JASA</em>, 74(366), 427-431.</li>
<li>Kwiatkowski, D., Phillips, P.C.B., Schmidt, P. & Shin, Y. (1992). "Testing the null hypothesis of stationarity." <em>Journal of Econometrics</em>, 54(1-3), 159-178.</li>
<li>Dil, A.R. (2025). "Testing for Time Series Stationarity: A Practical Guide to the Dickey-Fuller and Augmented Dickey-Fuller Tests." SSRN 5287311.</li>
</ol>
</div>

<h2>åã€æ€è€ƒé¢˜ / Think About It</h2>

<div class="insight">
<strong>ğŸ’­ å¦‚æœä¸€ä¸ªä»·å·®åºåˆ—åœ¨ 2020-2023 å¹´é€šè¿‡äº† ADF æ£€éªŒï¼ˆå¹³ç¨³ï¼‰ï¼Œä½†åœ¨ 2024-2025 å¹´ä¸å†å¹³ç¨³ï¼Œä½ çš„é…å¯¹äº¤æ˜“ç­–ç•¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä½ å¦‚ä½•è®¾è®¡ä¸€ä¸ª"è‡ªé€‚åº”"çš„å¹³ç¨³æ€§ç›‘æ§ç³»ç»Ÿæ¥å®æ—¶æ£€æµ‹è¿™ç§ regime changeï¼Ÿ</strong><br><br>
<em>What if a spread passes the ADF test in 2020-2023 but becomes non-stationary in 2024-2025? What happens to your pairs trading strategy? How would you design an adaptive stationarity monitoring system to detect such regime changes in real-time?</em>
</div>

<hr>
<p style="text-align: center; color: #888; font-size: 13px;">
ğŸ“š Knowledge Agent | Quant Trading Series Day 5 | 2026-02-20<br>
Phase 1: Foundations (5/7)
</p>

</body>
</html>
